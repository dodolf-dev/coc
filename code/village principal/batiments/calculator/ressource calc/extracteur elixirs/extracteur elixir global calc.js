import { extracteur_elixir1_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { extracteur_elixir2_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { extracteur_elixir3_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { extracteur_elixir4_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { extracteur_elixir5_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { extracteur_elixir6_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { extracteur_elixir7_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerTempsTotalextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerTempsTotalextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerTempsTotalextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerTempsTotalextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerTempsTotalextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerTempsTotalextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerTempsTotalextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerTempsRestantextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";    
import { calculerTempsRestantextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerTempsRestantextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerTempsRestantextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerTempsRestantextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerTempsRestantextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerTempsRestantextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerTempsdepuisHDVextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerTempsdepuisHDVextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerTempsdepuisHDVextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerTempsdepuisHDVextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerTempsdepuisHDVextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerTempsdepuisHDVextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerTempsdepuisHDVextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerTempsConstructionParHDVextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerTempsConstructionParHDVextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerTempsConstructionParHDVextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerTempsConstructionParHDVextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerTempsConstructionParHDVextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerTempsConstructionParHDVextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerTempsConstructionParHDVextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerPrixTotalextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerPrixTotalextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerPrixTotalextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerPrixTotalextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerPrixTotalextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerPrixTotalextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerPrixTotalextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerPrixRestantextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerPrixRestantextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerPrixRestantextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerPrixRestantextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerPrixRestantextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerPrixRestantextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerPrixRestantextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerPrixdepuisHDVextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerPrixdepuisHDVextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerPrixdepuisHDVextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerPrixdepuisHDVextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerPrixdepuisHDVextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerPrixdepuisHDVextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerPrixdepuisHDVextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerPrixConstructionParHDVextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerPrixConstructionParHDVextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerPrixConstructionParHDVextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerPrixConstructionParHDVextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerPrixConstructionParHDVextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerPrixConstructionParHDVextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerPrixConstructionParHDVextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerExperienceTotalextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerExperienceTotalextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerExperienceTotalextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerExperienceTotalextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerExperienceTotalextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerExperienceTotalextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerExperienceTotalextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerExperienceRestantextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerExperienceRestantextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerExperienceRestantextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerExperienceRestantextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerExperienceRestantextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerExperienceRestantextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerExperienceRestantextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerExperiencedepuisHDVextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerExperiencedepuisHDVextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerExperiencedepuisHDVextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerExperiencedepuisHDVextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerExperiencedepuisHDVextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerExperiencedepuisHDVextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerExperiencedepuisHDVextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { calculerExperienceConstructionParHDVextracteur_elixir1 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir1.calc.js";
import { calculerExperienceConstructionParHDVextracteur_elixir2 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir2.calc.js";
import { calculerExperienceConstructionParHDVextracteur_elixir3 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir3.calc.js";
import { calculerExperienceConstructionParHDVextracteur_elixir4 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir4.calc.js";
import { calculerExperienceConstructionParHDVextracteur_elixir5 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir5.calc.js";
import { calculerExperienceConstructionParHDVextracteur_elixir6 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir6.calc.js";
import { calculerExperienceConstructionParHDVextracteur_elixir7 } from "/coc/code/village principal/batiments/calculator/ressource calc/extracteur elixirs/extracteur elixir7.calc.js";

import { formatPrix } from "/coc/code/outils/affichge nombre.js";
import { convertirSecondescompact } from "/coc/code/outils/convertisseurtemps.js";

function getHDVLevel() {
    return document.getElementById("hdv").value;
}

function getextracteur_elixirLevel(num) {
    return document.getElementById(`extracteur_elixir${num}`).value;
}

let hdvlevel = getHDVLevel(); // Récupérer le niveau de l'Hôtel de Ville

let extracteur_elixir1level = getextracteur_elixirLevel(1);
let extracteur_elixir2level = getextracteur_elixirLevel(2);
let extracteur_elixir3level = getextracteur_elixirLevel(3);
let extracteur_elixir4level = getextracteur_elixirLevel(4);
let extracteur_elixir5level = getextracteur_elixirLevel(5);
let extracteur_elixir6level = getextracteur_elixirLevel(6);
let extracteur_elixir7level = getextracteur_elixirLevel(7);

let extracteur_elixir1levelmax = extracteur_elixir1_nv_max_hdv(hdvlevel);
let extracteur_elixir2levelmax = extracteur_elixir2_nv_max_hdv(hdvlevel);
let extracteur_elixir3levelmax = extracteur_elixir3_nv_max_hdv(hdvlevel);
let extracteur_elixir4levelmax = extracteur_elixir4_nv_max_hdv(hdvlevel);
let extracteur_elixir5levelmax = extracteur_elixir5_nv_max_hdv(hdvlevel);
let extracteur_elixir6levelmax = extracteur_elixir6_nv_max_hdv(hdvlevel);
let extracteur_elixir7levelmax = extracteur_elixir7_nv_max_hdv(hdvlevel);

export function calculerPourcentageNiveauxextracteur_elixirs() {
    // Niveaux actuels
    const niveauxActuels = [
        Math.min(extracteur_elixir1level, extracteur_elixir1levelmax),
        Math.min(extracteur_elixir2level, extracteur_elixir2levelmax),
        Math.min(extracteur_elixir3level, extracteur_elixir3levelmax),
        Math.min(extracteur_elixir4level, extracteur_elixir4levelmax),
        Math.min(extracteur_elixir5level, extracteur_elixir5levelmax),
        Math.min(extracteur_elixir6level, extracteur_elixir6levelmax),
        Math.min(extracteur_elixir7level, extracteur_elixir7levelmax)
    ];

    // Niveaux max possibles selon HDV
    const niveauxMax = [
        extracteur_elixir1levelmax,
        extracteur_elixir2levelmax,
        extracteur_elixir3levelmax,
        extracteur_elixir4levelmax,
        extracteur_elixir5levelmax,
        extracteur_elixir6levelmax,
        extracteur_elixir7levelmax
    ];

    // Calcul des totaux
    const totalMax = niveauxMax.reduce((a, b) => a + b, 0);
    const totalActuel = niveauxActuels.reduce((a, b) => a + b, 0);

    if (totalMax === 0) return 0; // Évite la division par zéro

    const progression = (totalActuel / totalMax) * 100;
    return parseFloat(progression.toFixed(2)); // Limite a 2 décimales
}

export function globalcalculertempsRestantextracteur_elixirs() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const extracteur_elixir1level = parseInt(getextracteur_elixirLevel(1), 10);
    const extracteur_elixir2level = parseInt(getextracteur_elixirLevel(2), 10);
    const extracteur_elixir3level = parseInt(getextracteur_elixirLevel(3), 10);
    const extracteur_elixir4level = parseInt(getextracteur_elixirLevel(4), 10);
    const extracteur_elixir5level = parseInt(getextracteur_elixirLevel(5), 10);
    const extracteur_elixir6level = parseInt(getextracteur_elixirLevel(6), 10);
    const extracteur_elixir7level = parseInt(getextracteur_elixirLevel(7), 10);

    const extracteur_elixir1levelmax = extracteur_elixir1_nv_max_hdv(hdvlevel);
    const extracteur_elixir2levelmax = extracteur_elixir2_nv_max_hdv(hdvlevel);
    const extracteur_elixir3levelmax = extracteur_elixir3_nv_max_hdv(hdvlevel);
    const extracteur_elixir4levelmax = extracteur_elixir4_nv_max_hdv(hdvlevel);
    const extracteur_elixir5levelmax = extracteur_elixir5_nv_max_hdv(hdvlevel);
    const extracteur_elixir6levelmax = extracteur_elixir6_nv_max_hdv(hdvlevel);
    const extracteur_elixir7levelmax = extracteur_elixir7_nv_max_hdv(hdvlevel);

    let tempsRestant = 0;
    tempsRestant += calculerTempsRestantextracteur_elixir1(extracteur_elixir1level, extracteur_elixir1levelmax);
    tempsRestant += calculerTempsRestantextracteur_elixir2(extracteur_elixir2level, extracteur_elixir2levelmax);
    tempsRestant += calculerTempsRestantextracteur_elixir3(extracteur_elixir3level, extracteur_elixir3levelmax);
    tempsRestant += calculerTempsRestantextracteur_elixir4(extracteur_elixir4level, extracteur_elixir4levelmax);
    tempsRestant += calculerTempsRestantextracteur_elixir5(extracteur_elixir5level, extracteur_elixir5levelmax);
    tempsRestant += calculerTempsRestantextracteur_elixir6(extracteur_elixir6level, extracteur_elixir6levelmax);
    tempsRestant += calculerTempsRestantextracteur_elixir7(extracteur_elixir7level, extracteur_elixir7levelmax);

    return tempsRestant;
}

export function globalcalculertempsTotalextracteur_elixirs() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsTotalextracteur_elixir1(extracteur_elixir1level);
    tempsTotal += calculerTempsTotalextracteur_elixir2(extracteur_elixir2level);
    tempsTotal += calculerTempsTotalextracteur_elixir3(extracteur_elixir3level);
    tempsTotal += calculerTempsTotalextracteur_elixir4(extracteur_elixir4level);
    tempsTotal += calculerTempsTotalextracteur_elixir5(extracteur_elixir5level);
    tempsTotal += calculerTempsTotalextracteur_elixir6(extracteur_elixir6level);
    tempsTotal += calculerTempsTotalextracteur_elixir7(extracteur_elixir7level);
    return tempsTotal;
}

export function globalcalculertempsdepuisHDVextracteur_elixirs() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsdepuisHDVextracteur_elixir1(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVextracteur_elixir2(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVextracteur_elixir3(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVextracteur_elixir4(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVextracteur_elixir5(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVextracteur_elixir6(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVextracteur_elixir7(hdvlevel);
    return tempsTotal;
}

export function globalcalculertempsConstructionParHDVextracteur_elixirs() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsConstructionParHDVextracteur_elixir1(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVextracteur_elixir2(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVextracteur_elixir3(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVextracteur_elixir4(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVextracteur_elixir5(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVextracteur_elixir6(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVextracteur_elixir7(hdvlevel);
    return tempsTotal;
}

export function barredeprogressiontempsextracteur_elixirs() {
    const tempsTotal = globalcalculertempsTotalextracteur_elixirs();
    const tempsRestant = globalcalculertempsRestantextracteur_elixirs();
    const tempsConstructionHDV = globalcalculertempsConstructionParHDVextracteur_elixirs();

    if (tempsTotal === 0) {
        return 0; // Évite la division par zéro
    }

    if (tempsTotal >= tempsConstructionHDV) {
        const progression = ((tempsTotal - tempsRestant) / tempsTotal) * 100;
        return progression.toFixed(2);
    } else {
        // Ajout d'une tolérance pour éviter des valeurs négatives excessives
        const difference = tempsConstructionHDV - tempsTotal;
        if (difference < 0.01 * tempsConstructionHDV) { // Tolérance de 1%
            return 0; // Considérer comme aucune progression négative
        }
        const retard = (difference / tempsConstructionHDV) * 100;
        return (-retard).toFixed(2);
    }
}

export function globalcalculerPrixTotalextracteur_elixir() {
    let couttotal = 0;
    couttotal += calculerPrixTotalextracteur_elixir1(extracteur_elixir1level);
    couttotal += calculerPrixTotalextracteur_elixir2(extracteur_elixir2level);
    couttotal += calculerPrixTotalextracteur_elixir3(extracteur_elixir3level);
    couttotal += calculerPrixTotalextracteur_elixir4(extracteur_elixir4level);
    couttotal += calculerPrixTotalextracteur_elixir5(extracteur_elixir5level);
    couttotal += calculerPrixTotalextracteur_elixir6(extracteur_elixir6level);
    couttotal += calculerPrixTotalextracteur_elixir7(extracteur_elixir7level);
    return couttotal;
}

export function globalcalculerPrixRestantextracteur_elixir() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const extracteur_elixir1level = parseInt(getextracteur_elixirLevel(1), 10);
    const extracteur_elixir2level = parseInt(getextracteur_elixirLevel(2), 10);
    const extracteur_elixir3level = parseInt(getextracteur_elixirLevel(3), 10);
    const extracteur_elixir4level = parseInt(getextracteur_elixirLevel(4), 10);
    const extracteur_elixir5level = parseInt(getextracteur_elixirLevel(5), 10);
    const extracteur_elixir6level = parseInt(getextracteur_elixirLevel(6), 10);
    const extracteur_elixir7level = parseInt(getextracteur_elixirLevel(7), 10);

    const extracteur_elixir1levelmax = extracteur_elixir1_nv_max_hdv(hdvlevel);
    const extracteur_elixir2levelmax = extracteur_elixir2_nv_max_hdv(hdvlevel);
    const extracteur_elixir3levelmax = extracteur_elixir3_nv_max_hdv(hdvlevel);
    const extracteur_elixir4levelmax = extracteur_elixir4_nv_max_hdv(hdvlevel);
    const extracteur_elixir5levelmax = extracteur_elixir5_nv_max_hdv(hdvlevel);
    const extracteur_elixir6levelmax = extracteur_elixir6_nv_max_hdv(hdvlevel);
    const extracteur_elixir7levelmax = extracteur_elixir7_nv_max_hdv(hdvlevel);

    let coutrestant = 0;
    coutrestant += calculerPrixRestantextracteur_elixir1(extracteur_elixir1level, extracteur_elixir1levelmax);
    coutrestant += calculerPrixRestantextracteur_elixir2(extracteur_elixir2level, extracteur_elixir2levelmax);
    coutrestant += calculerPrixRestantextracteur_elixir3(extracteur_elixir3level, extracteur_elixir3levelmax);
    coutrestant += calculerPrixRestantextracteur_elixir4(extracteur_elixir4level, extracteur_elixir4levelmax);
    coutrestant += calculerPrixRestantextracteur_elixir5(extracteur_elixir5level, extracteur_elixir5levelmax);
    coutrestant += calculerPrixRestantextracteur_elixir6(extracteur_elixir6level, extracteur_elixir6levelmax);
    coutrestant += calculerPrixRestantextracteur_elixir7(extracteur_elixir7level, extracteur_elixir7levelmax);
    return coutrestant;
}

export function globalcalculerPrixdepuisHDVextracteur_elixir() {
    let couttotal = 0;
    couttotal += calculerPrixdepuisHDVextracteur_elixir1(hdvlevel);
    couttotal += calculerPrixdepuisHDVextracteur_elixir2(hdvlevel);
    couttotal += calculerPrixdepuisHDVextracteur_elixir3(hdvlevel);
    couttotal += calculerPrixdepuisHDVextracteur_elixir4(hdvlevel);
    couttotal += calculerPrixdepuisHDVextracteur_elixir5(hdvlevel);
    couttotal += calculerPrixdepuisHDVextracteur_elixir6(hdvlevel);
    couttotal += calculerPrixdepuisHDVextracteur_elixir7(hdvlevel);
    return couttotal;
}

export function globalcalculerPrixConstructionParHDVextracteur_elixir() {
    let couttotal = 0;
    couttotal += calculerPrixConstructionParHDVextracteur_elixir1(hdvlevel);
    couttotal += calculerPrixConstructionParHDVextracteur_elixir2(hdvlevel);
    couttotal += calculerPrixConstructionParHDVextracteur_elixir3(hdvlevel);
    couttotal += calculerPrixConstructionParHDVextracteur_elixir4(hdvlevel);
    couttotal += calculerPrixConstructionParHDVextracteur_elixir5(hdvlevel);
    couttotal += calculerPrixConstructionParHDVextracteur_elixir6(hdvlevel);
    couttotal += calculerPrixConstructionParHDVextracteur_elixir7(hdvlevel);
    return couttotal;
}

export function barredeprogrssionprixextracteur_elixirs () {
    const prixTotal = globalcalculerprixTotalextracteur_elixirs();
    const prixRestant = globalcalculerprixRestantextracteur_elixirs();
    const prixConstructionHDV = globalcalculerprixConstructionParHDVextracteur_elixirs();
    if (prixTotal > prixConstructionHDV) {
        let progression = ((prixTotal - prixRestant) / prixTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((prixConstructionHDV - prixTotal) / prixTotal) * 100;
        return (-retard).toFixed(2);
    }
}


export function globalcalculerExperienceTotalextracteur_elixir() {
    let expTotal = 0;
    expTotal += calculerExperienceTotalextracteur_elixir1(extracteur_elixir1level);
    expTotal += calculerExperienceTotalextracteur_elixir2(extracteur_elixir2level);
    expTotal += calculerExperienceTotalextracteur_elixir3(extracteur_elixir3level);
    expTotal += calculerExperienceTotalextracteur_elixir4(extracteur_elixir4level);
    expTotal += calculerExperienceTotalextracteur_elixir5(extracteur_elixir5level);
    expTotal += calculerExperienceTotalextracteur_elixir6(extracteur_elixir6level);
    expTotal += calculerExperienceTotalextracteur_elixir7(extracteur_elixir7level);
    return expTotal;
}

export function globalcalculerExperienceRestantextracteur_elixir() {
    let exprestant = 0;
    exprestant += calculerExperienceRestantextracteur_elixir1(extracteur_elixir1level, extracteur_elixir1levelmax);
    exprestant += calculerExperienceRestantextracteur_elixir2(extracteur_elixir2level, extracteur_elixir2levelmax);
    exprestant += calculerExperienceRestantextracteur_elixir3(extracteur_elixir3level, extracteur_elixir3levelmax);
    exprestant += calculerExperienceRestantextracteur_elixir4(extracteur_elixir4level, extracteur_elixir4levelmax);
    exprestant += calculerExperienceRestantextracteur_elixir5(extracteur_elixir5level, extracteur_elixir5levelmax);
    exprestant += calculerExperienceRestantextracteur_elixir6(extracteur_elixir6level, extracteur_elixir6levelmax);
    exprestant += calculerExperienceRestantextracteur_elixir7(extracteur_elixir7level, extracteur_elixir7levelmax);
    return exprestant;
}

export function globalcalculerExperiencedepuisHDVextracteur_elixir() {
    let exptotal = 0;
    exptotal += calculerExperiencedepuisHDVextracteur_elixir1(hdvlevel);
    exptotal += calculerExperiencedepuisHDVextracteur_elixir2(hdvlevel);
    exptotal += calculerExperiencedepuisHDVextracteur_elixir3(hdvlevel);
    exptotal += calculerExperiencedepuisHDVextracteur_elixir4(hdvlevel);
    exptotal += calculerExperiencedepuisHDVextracteur_elixir5(hdvlevel);
    exptotal += calculerExperiencedepuisHDVextracteur_elixir6(hdvlevel);
    exptotal += calculerExperiencedepuisHDVextracteur_elixir7(hdvlevel);
    return exptotal;
}

export function globalcalculerExperienceConstructionParHDVextracteur_elixir() {
    let exptotal = 0;
    exptotal += calculerExperienceConstructionParHDVextracteur_elixir1(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVextracteur_elixir2(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVextracteur_elixir3(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVextracteur_elixir4(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVextracteur_elixir5(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVextracteur_elixir6(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVextracteur_elixir7(hdvlevel);
    return exptotal;
}

export function barredeprogressionexpextracteur_elixirs() {
    const expTotal = globalcalculerExperienceTotalextracteur_elixir();
    const expRestant = globalcalculerExperienceRestantextracteur_elixir();
    const expConstructionHDV = globalcalculerExperienceConstructionParHDVextracteur_elixir();
    if (expTotal > expConstructionHDV) {
        let progression = ((expTotal - expRestant) / expTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((expConstructionHDV - expTotal) / expTotal) * 100;
        return (-retard).toFixed(2);
    }
}

// Fonction pour mettre à jour la barre de progression
function updateextracteur_elixirProgress() {
    // Recalculer le niveau de l'Hôtel de Ville
    hdvlevel = getHDVLevel();

    // Recalculer les niveaux des extracteur_elixirs
    extracteur_elixir1level = getextracteur_elixirLevel(1);
    extracteur_elixir2level = getextracteur_elixirLevel(2);
    extracteur_elixir3level = getextracteur_elixirLevel(3);
    extracteur_elixir4level = getextracteur_elixirLevel(4);
    extracteur_elixir5level = getextracteur_elixirLevel(5);
    extracteur_elixir6level = getextracteur_elixirLevel(6);
    extracteur_elixir7level = getextracteur_elixirLevel(7);


    // Recalculer les niveaux maximums des extracteur_elixirs en fonction du niveau HDV
    extracteur_elixir1levelmax = extracteur_elixir1_nv_max_hdv(hdvlevel);
    extracteur_elixir2levelmax = extracteur_elixir2_nv_max_hdv(hdvlevel);
    extracteur_elixir3levelmax = extracteur_elixir3_nv_max_hdv(hdvlevel);
    extracteur_elixir4levelmax = extracteur_elixir4_nv_max_hdv(hdvlevel);
    extracteur_elixir5levelmax = extracteur_elixir5_nv_max_hdv(hdvlevel);
    extracteur_elixir6levelmax = extracteur_elixir6_nv_max_hdv(hdvlevel);
    extracteur_elixir7levelmax = extracteur_elixir7_nv_max_hdv(hdvlevel);
    // Calculer le pourcentage de progression
    const progression = calculerPourcentageNiveauxextracteur_elixirs();

    // Mettre à jour la barre de progression et le texte
    const progressBar = document.getElementById('progress-extracteur_elixirs');
    const progressText = document.getElementById('progress-extracteur_elixirs-value');
    const progressTimeText = document.getElementById('progress-extracteur_elixirs-temps');
    const progressPriceText = document.getElementById('progress-extracteur_elixirs-prix-or');

    if (progressBar && progressText) {
        progressBar.value = progression;
        progressText.textContent = `${progression}%`; // Limiter à 2 décimales
    }
    if (progressTimeText) {
        const tempsRestant = globalcalculertempsRestantextracteur_elixirs();
        progressTimeText.innerHTML = `${convertirSecondescompact(tempsRestant)} <img src="/coc/image/général/ressource/temps icone.png" alt="temps" class="icone-ressource">`;
    }
    if (progressPriceText) {
        const prixRestant = globalcalculerPrixRestantextracteur_elixir();
        progressPriceText.innerHTML = `${formatPrix(prixRestant)} <img src="/coc/image/village principal/ressource/or village-p.jpg" alt="or" class="icone-ressource">`;
    }
}

// Ajouter des écouteurs d'événements pour détecter les changements
document.addEventListener('DOMContentLoaded', () => {
    const extracteur_elixirSelects = [
        document.getElementById('extracteur_elixir1'),
        document.getElementById('extracteur_elixir2'),
        document.getElementById('extracteur_elixir3'),
        document.getElementById('extracteur_elixir4'),
        document.getElementById('extracteur_elixir5'),
        document.getElementById('extracteur_elixir6'),
        document.getElementById('extracteur_elixir7')
    ];

    // Ajouter un écouteur pour chaque extracteur_elixir
    extracteur_elixirSelects.forEach(select => {
        if (select) {
            select.addEventListener('change', updateextracteur_elixirProgress);
        }
    });

    // Ajouter un écouteur pour le changement du niveau HDV
    const hdvSelect = document.getElementById('hdv');
    if (hdvSelect) {
        hdvSelect.addEventListener('change', updateextracteur_elixirProgress);
    }

    // Initialiser la barre de progression au chargement
    updateextracteur_elixirProgress();
});