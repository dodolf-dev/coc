import { canon1_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { canon2_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { canon3_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { canon4_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { canon5_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { canon6_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { canon7_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerTempsTotalcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerTempsTotalcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerTempsTotalcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerTempsTotalcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerTempsTotalcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerTempsTotalcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerTempsTotalcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerTempsRestantcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";    
import { calculerTempsRestantcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerTempsRestantcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerTempsRestantcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerTempsRestantcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerTempsRestantcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerTempsRestantcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerTempsdepuisHDVcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerTempsdepuisHDVcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerTempsdepuisHDVcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerTempsdepuisHDVcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerTempsdepuisHDVcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerTempsdepuisHDVcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerTempsdepuisHDVcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerTempsConstructionParHDVcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerTempsConstructionParHDVcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerTempsConstructionParHDVcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerTempsConstructionParHDVcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerTempsConstructionParHDVcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerTempsConstructionParHDVcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerTempsConstructionParHDVcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerPrixTotalcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerPrixTotalcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerPrixTotalcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerPrixTotalcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerPrixTotalcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerPrixTotalcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerPrixTotalcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerPrixRestantcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerPrixRestantcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerPrixRestantcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerPrixRestantcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerPrixRestantcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerPrixRestantcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerPrixRestantcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerPrixdepuisHDVcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerPrixdepuisHDVcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerPrixdepuisHDVcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerPrixdepuisHDVcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerPrixdepuisHDVcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerPrixdepuisHDVcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerPrixdepuisHDVcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerPrixConstructionParHDVcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerPrixConstructionParHDVcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerPrixConstructionParHDVcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerPrixConstructionParHDVcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerPrixConstructionParHDVcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerPrixConstructionParHDVcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerPrixConstructionParHDVcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerExperienceTotalcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerExperienceTotalcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerExperienceTotalcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerExperienceTotalcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerExperienceTotalcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerExperienceTotalcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerExperienceTotalcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerExperienceRestantcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerExperienceRestantcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerExperienceRestantcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerExperienceRestantcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerExperienceRestantcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerExperienceRestantcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerExperienceRestantcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerExperiencedepuisHDVcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerExperiencedepuisHDVcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerExperiencedepuisHDVcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerExperiencedepuisHDVcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerExperiencedepuisHDVcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerExperiencedepuisHDVcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerExperiencedepuisHDVcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { calculerExperienceConstructionParHDVcanon1 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon1.calc.js";
import { calculerExperienceConstructionParHDVcanon2 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon2.calc.js";
import { calculerExperienceConstructionParHDVcanon3 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon3.calc.js";
import { calculerExperienceConstructionParHDVcanon4 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon4.calc.js";
import { calculerExperienceConstructionParHDVcanon5 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon5.calc.js";
import { calculerExperienceConstructionParHDVcanon6 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon6.calc.js";
import { calculerExperienceConstructionParHDVcanon7 } from "/coc/code/village principal/batiments/calculator/defense calc/canons/canon7.calc.js";

import { formatPrix } from "/coc/code/outils/affichge nombre.js";
import { convertirSecondescompact } from "/coc/code/outils/convertisseurtemps.js";

function getHDVLevel() {
    return document.getElementById("hdv").value;
}

function getCanonLevel(num) {
    return document.getElementById(`canon${num}`).value;
}

let hdvlevel = getHDVLevel(); // Récupérer le niveau de l'Hôtel de Ville

let canon1level = getCanonLevel(1);
let canon2level = getCanonLevel(2);
let canon3level = getCanonLevel(3);
let canon4level = getCanonLevel(4);
let canon5level = getCanonLevel(5);
let canon6level = getCanonLevel(6);
let canon7level = getCanonLevel(7);

let canon1levelmax = canon1_nv_max_hdv(hdvlevel);
let canon2levelmax = canon2_nv_max_hdv(hdvlevel);
let canon3levelmax = canon3_nv_max_hdv(hdvlevel);
let canon4levelmax = canon4_nv_max_hdv(hdvlevel);
let canon5levelmax = canon5_nv_max_hdv(hdvlevel);
let canon6levelmax = canon6_nv_max_hdv(hdvlevel);
let canon7levelmax = canon7_nv_max_hdv(hdvlevel);

export function calculerPourcentageNiveauxCanons() {
    // Niveaux actuels
    const niveauxActuels = [
        Math.min(canon1level, canon1levelmax),
        Math.min(canon2level, canon2levelmax),
        Math.min(canon3level, canon3levelmax),
        Math.min(canon4level, canon4levelmax),
        Math.min(canon5level, canon5levelmax),
        Math.min(canon6level, canon6levelmax),
        Math.min(canon7level, canon7levelmax)
    ];

    // Niveaux max possibles selon HDV
    const niveauxMax = [
        canon1levelmax,
        canon2levelmax,
        canon3levelmax,
        canon4levelmax,
        canon5levelmax,
        canon6levelmax,
        canon7levelmax
    ];

    // Calcul des totaux
    const totalMax = niveauxMax.reduce((a, b) => a + b, 0);
    const totalActuel = niveauxActuels.reduce((a, b) => a + b, 0);

    if (totalMax === 0) return 0; // Évite la division par zéro

    const progression = (totalActuel / totalMax) * 100;
    return parseFloat(progression.toFixed(2)); // Limite a 2 décimales
}

export function globalcalculertempsRestantcanons() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const canon1level = parseInt(getCanonLevel(1), 10);
    const canon2level = parseInt(getCanonLevel(2), 10);
    const canon3level = parseInt(getCanonLevel(3), 10);
    const canon4level = parseInt(getCanonLevel(4), 10);
    const canon5level = parseInt(getCanonLevel(5), 10);
    const canon6level = parseInt(getCanonLevel(6), 10);
    const canon7level = parseInt(getCanonLevel(7), 10);

    const canon1levelmax = canon1_nv_max_hdv(hdvlevel);
    const canon2levelmax = canon2_nv_max_hdv(hdvlevel);
    const canon3levelmax = canon3_nv_max_hdv(hdvlevel);
    const canon4levelmax = canon4_nv_max_hdv(hdvlevel);
    const canon5levelmax = canon5_nv_max_hdv(hdvlevel);
    const canon6levelmax = canon6_nv_max_hdv(hdvlevel);
    const canon7levelmax = canon7_nv_max_hdv(hdvlevel);

    let tempsRestant = 0;
    tempsRestant += calculerTempsRestantcanon1(canon1level, canon1levelmax);
    tempsRestant += calculerTempsRestantcanon2(canon2level, canon2levelmax);
    tempsRestant += calculerTempsRestantcanon3(canon3level, canon3levelmax);
    tempsRestant += calculerTempsRestantcanon4(canon4level, canon4levelmax);
    tempsRestant += calculerTempsRestantcanon5(canon5level, canon5levelmax);
    tempsRestant += calculerTempsRestantcanon6(canon6level, canon6levelmax);
    tempsRestant += calculerTempsRestantcanon7(canon7level, canon7levelmax);

    return tempsRestant;
}

export function globalcalculertempsTotalcanons() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsTotalcanon1(canon1level);
    tempsTotal += calculerTempsTotalcanon2(canon2level);
    tempsTotal += calculerTempsTotalcanon3(canon3level);
    tempsTotal += calculerTempsTotalcanon4(canon4level);
    tempsTotal += calculerTempsTotalcanon5(canon5level);
    tempsTotal += calculerTempsTotalcanon6(canon6level);
    tempsTotal += calculerTempsTotalcanon7(canon7level);
    return tempsTotal;
}

export function globalcalculertempsdepuisHDVcanons() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsdepuisHDVcanon1(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVcanon2(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVcanon3(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVcanon4(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVcanon5(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVcanon6(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVcanon7(hdvlevel);
    return tempsTotal;
}

export function globalcalculertempsConstructionParHDVcanons() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsConstructionParHDVcanon1(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVcanon2(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVcanon3(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVcanon4(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVcanon5(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVcanon6(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVcanon7(hdvlevel);
    return tempsTotal;
}

export function barredeprogressiontempscanons() {
    const tempsTotal = globalcalculertempsTotalcanons();
    const tempsRestant = globalcalculertempsRestantcanons();
    const tempsConstructionHDV = globalcalculertempsConstructionParHDVcanons();

    if (tempsTotal === 0) {
        return 0; // Évite la division par zéro
    }

    if (tempsTotal >= tempsConstructionHDV) {
        const progression = ((tempsTotal - tempsRestant) / tempsTotal) * 100;
        return progression.toFixed(2);
    } else {
        // Ajout d'une tolérance pour éviter des valeurs négatives excessives
        const difference = tempsConstructionHDV - tempsTotal;
        if (difference < 0.01 * tempsConstructionHDV) { // Tolérance de 1%
            return 0; // Considérer comme aucune progression négative
        }
        const retard = (difference / tempsConstructionHDV) * 100;
        return (-retard).toFixed(2);
    }
}

export function globalcalculerPrixTotalcanon() {
    let couttotal = 0;
    couttotal += calculerPrixTotalcanon1(canon1level);
    couttotal += calculerPrixTotalcanon2(canon2level);
    couttotal += calculerPrixTotalcanon3(canon3level);
    couttotal += calculerPrixTotalcanon4(canon4level);
    couttotal += calculerPrixTotalcanon5(canon5level);
    couttotal += calculerPrixTotalcanon6(canon6level);
    couttotal += calculerPrixTotalcanon7(canon7level);
    return couttotal;
}

export function globalcalculerPrixRestantcanon() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const canon1level = parseInt(getCanonLevel(1), 10);
    const canon2level = parseInt(getCanonLevel(2), 10);
    const canon3level = parseInt(getCanonLevel(3), 10);
    const canon4level = parseInt(getCanonLevel(4), 10);
    const canon5level = parseInt(getCanonLevel(5), 10);
    const canon6level = parseInt(getCanonLevel(6), 10);
    const canon7level = parseInt(getCanonLevel(7), 10);

    const canon1levelmax = canon1_nv_max_hdv(hdvlevel);
    const canon2levelmax = canon2_nv_max_hdv(hdvlevel);
    const canon3levelmax = canon3_nv_max_hdv(hdvlevel);
    const canon4levelmax = canon4_nv_max_hdv(hdvlevel);
    const canon5levelmax = canon5_nv_max_hdv(hdvlevel);
    const canon6levelmax = canon6_nv_max_hdv(hdvlevel);
    const canon7levelmax = canon7_nv_max_hdv(hdvlevel);

    let coutrestant = 0;
    coutrestant += calculerPrixRestantcanon1(canon1level, canon1levelmax);
    coutrestant += calculerPrixRestantcanon2(canon2level, canon2levelmax);
    coutrestant += calculerPrixRestantcanon3(canon3level, canon3levelmax);
    coutrestant += calculerPrixRestantcanon4(canon4level, canon4levelmax);
    coutrestant += calculerPrixRestantcanon5(canon5level, canon5levelmax);
    coutrestant += calculerPrixRestantcanon6(canon6level, canon6levelmax);
    coutrestant += calculerPrixRestantcanon7(canon7level, canon7levelmax);
    return coutrestant;
}

export function globalcalculerPrixdepuisHDVcanon() {
    let couttotal = 0;
    couttotal += calculerPrixdepuisHDVcanon1(hdvlevel);
    couttotal += calculerPrixdepuisHDVcanon2(hdvlevel);
    couttotal += calculerPrixdepuisHDVcanon3(hdvlevel);
    couttotal += calculerPrixdepuisHDVcanon4(hdvlevel);
    couttotal += calculerPrixdepuisHDVcanon5(hdvlevel);
    couttotal += calculerPrixdepuisHDVcanon6(hdvlevel);
    couttotal += calculerPrixdepuisHDVcanon7(hdvlevel);
    return couttotal;
}

export function globalcalculerPrixConstructionParHDVcanon() {
    let couttotal = 0;
    couttotal += calculerPrixConstructionParHDVcanon1(hdvlevel);
    couttotal += calculerPrixConstructionParHDVcanon2(hdvlevel);
    couttotal += calculerPrixConstructionParHDVcanon3(hdvlevel);
    couttotal += calculerPrixConstructionParHDVcanon4(hdvlevel);
    couttotal += calculerPrixConstructionParHDVcanon5(hdvlevel);
    couttotal += calculerPrixConstructionParHDVcanon6(hdvlevel);
    couttotal += calculerPrixConstructionParHDVcanon7(hdvlevel);
    return couttotal;
}

export function barredeprogrssionprixcanons () {
    const prixTotal = globalcalculerprixTotalcanons();
    const prixRestant = globalcalculerprixRestantcanons();
    const prixConstructionHDV = globalcalculerprixConstructionParHDVcanons();
    if (prixTotal > prixConstructionHDV) {
        let progression = ((prixTotal - prixRestant) / prixTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((prixConstructionHDV - prixTotal) / prixTotal) * 100;
        return (-retard).toFixed(2);
    }
}


export function globalcalculerExperienceTotalcanon() {
    let expTotal = 0;
    expTotal += calculerExperienceTotalcanon1(canon1level);
    expTotal += calculerExperienceTotalcanon2(canon2level);
    expTotal += calculerExperienceTotalcanon3(canon3level);
    expTotal += calculerExperienceTotalcanon4(canon4level);
    expTotal += calculerExperienceTotalcanon5(canon5level);
    expTotal += calculerExperienceTotalcanon6(canon6level);
    expTotal += calculerExperienceTotalcanon7(canon7level);
    return expTotal;
}

export function globalcalculerExperienceRestantcanon() {
    let exprestant = 0;
    exprestant += calculerExperienceRestantcanon1(canon1level, canon1levelmax);
    exprestant += calculerExperienceRestantcanon2(canon2level, canon2levelmax);
    exprestant += calculerExperienceRestantcanon3(canon3level, canon3levelmax);
    exprestant += calculerExperienceRestantcanon4(canon4level, canon4levelmax);
    exprestant += calculerExperienceRestantcanon5(canon5level, canon5levelmax);
    exprestant += calculerExperienceRestantcanon6(canon6level, canon6levelmax);
    exprestant += calculerExperienceRestantcanon7(canon7level, canon7levelmax);
    return exprestant;
}

export function globalcalculerExperiencedepuisHDVcanon() {
    let exptotal = 0;
    exptotal += calculerExperiencedepuisHDVcanon1(hdvlevel);
    exptotal += calculerExperiencedepuisHDVcanon2(hdvlevel);
    exptotal += calculerExperiencedepuisHDVcanon3(hdvlevel);
    exptotal += calculerExperiencedepuisHDVcanon4(hdvlevel);
    exptotal += calculerExperiencedepuisHDVcanon5(hdvlevel);
    exptotal += calculerExperiencedepuisHDVcanon6(hdvlevel);
    exptotal += calculerExperiencedepuisHDVcanon7(hdvlevel);
    return exptotal;
}

export function globalcalculerExperienceConstructionParHDVcanon() {
    let exptotal = 0;
    exptotal += calculerExperienceConstructionParHDVcanon1(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVcanon2(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVcanon3(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVcanon4(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVcanon5(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVcanon6(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVcanon7(hdvlevel);
    return exptotal;
}

export function barredeprogressionexpcanons() {
    const expTotal = globalcalculerExperienceTotalcanon();
    const expRestant = globalcalculerExperienceRestantcanon();
    const expConstructionHDV = globalcalculerExperienceConstructionParHDVcanon();
    if (expTotal > expConstructionHDV) {
        let progression = ((expTotal - expRestant) / expTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((expConstructionHDV - expTotal) / expTotal) * 100;
        return (-retard).toFixed(2);
    }
}

// Fonction pour mettre à jour la barre de progression
function updateCanonProgress() {
    // Recalculer le niveau de l'Hôtel de Ville
    hdvlevel = getHDVLevel();

    // Recalculer les niveaux des canons
    canon1level = getCanonLevel(1);
    canon2level = getCanonLevel(2);
    canon3level = getCanonLevel(3);
    canon4level = getCanonLevel(4);
    canon5level = getCanonLevel(5);
    canon6level = getCanonLevel(6);
    canon7level = getCanonLevel(7);


    // Recalculer les niveaux maximums des canons en fonction du niveau HDV
    canon1levelmax = canon1_nv_max_hdv(hdvlevel);
    canon2levelmax = canon2_nv_max_hdv(hdvlevel);
    canon3levelmax = canon3_nv_max_hdv(hdvlevel);
    canon4levelmax = canon4_nv_max_hdv(hdvlevel);
    canon5levelmax = canon5_nv_max_hdv(hdvlevel);
    canon6levelmax = canon6_nv_max_hdv(hdvlevel);
    canon7levelmax = canon7_nv_max_hdv(hdvlevel);
    // Calculer le pourcentage de progression
    const progression = calculerPourcentageNiveauxCanons();

    // Mettre à jour la barre de progression et le texte
    const progressBar = document.getElementById('progress-canons');
    const progressText = document.getElementById('progress-canons-value');
    const progressTimeText = document.getElementById('progress-canons-temps');
    const progressPriceText = document.getElementById('progress-canons-prix-or');

    if (progressBar && progressText) {
        progressBar.value = progression;
        progressText.textContent = `${progression.toFixed(2)}%`; // Limiter à 2 décimales
    }
    if (progressTimeText) {
        const tempsRestant = globalcalculertempsRestantcanons();
        if (tempsRestant === 0) {
            progressTimeText.style.display = "none";
        } else {
            progressTimeText.style.display = "";
            progressTimeText.innerHTML = `${convertirSecondescompact(tempsRestant)} <img src="/coc/image/général/ressource/temps icone.png" alt="temps" class="icone-ressource">`;
        }
    }
    if (progressPriceText) {
        const prixRestant = globalcalculerPrixRestantcanon();
        if (prixRestant === 0) {
            progressPriceText.style.display = "none";
        }
        else {
            progressPriceText.style.display = "";
            progressPriceText.innerHTML = `${formatPrix(prixRestant)} <img src="/coc/image/village principal/ressource/or village-p.jpg" alt="or" class="icone-ressource">`;
        }
    }
}

// Ajouter des écouteurs d'événements pour détecter les changements
document.addEventListener('DOMContentLoaded', () => {
    const canonSelects = [
        document.getElementById('canon1'),
        document.getElementById('canon2'),
        document.getElementById('canon3'),
        document.getElementById('canon4'),
        document.getElementById('canon5'),
        document.getElementById('canon6'),
        document.getElementById('canon7')
    ];

    // Ajouter un écouteur pour chaque canon
    canonSelects.forEach(select => {
        if (select) {
            select.addEventListener('change', updateCanonProgress);
        }
    });

    // Ajouter un écouteur pour le changement du niveau HDV
    const hdvSelect = document.getElementById('hdv');
    if (hdvSelect) {
        hdvSelect.addEventListener('change', updateCanonProgress);
    }

    // Initialiser la barre de progression au chargement
    updateCanonProgress();
});