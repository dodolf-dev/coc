import { tour_sorcier1_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { tour_sorcier2_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { tour_sorcier3_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { tour_sorcier4_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { tour_sorcier5_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerTempsTotaltour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerTempsTotaltour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerTempsTotaltour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerTempsTotaltour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerTempsTotaltour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerTempsRestanttour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";    
import { calculerTempsRestanttour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerTempsRestanttour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerTempsRestanttour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerTempsRestanttour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerTempsdepuisHDVtour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerTempsdepuisHDVtour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerTempsdepuisHDVtour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerTempsdepuisHDVtour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerTempsdepuisHDVtour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerTempsConstructionParHDVtour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerTempsConstructionParHDVtour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerTempsConstructionParHDVtour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerTempsConstructionParHDVtour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerTempsConstructionParHDVtour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerPrixTotaltour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerPrixTotaltour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerPrixTotaltour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerPrixTotaltour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerPrixTotaltour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerPrixRestanttour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerPrixRestanttour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerPrixRestanttour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerPrixRestanttour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerPrixRestanttour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerPrixdepuisHDVtour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerPrixdepuisHDVtour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerPrixdepuisHDVtour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerPrixdepuisHDVtour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerPrixdepuisHDVtour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerPrixConstructionParHDVtour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerPrixConstructionParHDVtour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerPrixConstructionParHDVtour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerPrixConstructionParHDVtour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerPrixConstructionParHDVtour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerExperienceTotaltour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerExperienceTotaltour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerExperienceTotaltour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerExperienceTotaltour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerExperienceTotaltour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerExperienceRestanttour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerExperienceRestanttour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerExperienceRestanttour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerExperienceRestanttour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerExperienceRestanttour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerExperiencedepuisHDVtour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerExperiencedepuisHDVtour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerExperiencedepuisHDVtour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerExperiencedepuisHDVtour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerExperiencedepuisHDVtour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { calculerExperienceConstructionParHDVtour_sorcier1 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier1.calc.js";
import { calculerExperienceConstructionParHDVtour_sorcier2 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier2.calc.js";
import { calculerExperienceConstructionParHDVtour_sorcier3 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier3.calc.js";
import { calculerExperienceConstructionParHDVtour_sorcier4 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier4.calc.js";
import { calculerExperienceConstructionParHDVtour_sorcier5 } from "/coc/code/village principal/batiments/calculator/defense calc/tour sorciers/tour sorcier5.calc.js";

import { formatPrix } from "/coc/code/outils/affichge nombre.js";
import { convertirSecondescompact } from "/coc/code/outils/convertisseurtemps.js";

function getHDVLevel() {
    return document.getElementById("hdv").value;
}

function gettour_sorcierLevel(num) {
    return document.getElementById(`tour_sorcier${num}`).value;
}

let hdvlevel = getHDVLevel(); // Récupérer le niveau de l'Hôtel de Ville

let tour_sorcier1level = gettour_sorcierLevel(1);
let tour_sorcier2level = gettour_sorcierLevel(2);
let tour_sorcier3level = gettour_sorcierLevel(3);
let tour_sorcier4level = gettour_sorcierLevel(4);
let tour_sorcier5level = gettour_sorcierLevel(5);

let tour_sorcier1levelmax = tour_sorcier1_nv_max_hdv(hdvlevel);
let tour_sorcier2levelmax = tour_sorcier2_nv_max_hdv(hdvlevel);
let tour_sorcier3levelmax = tour_sorcier3_nv_max_hdv(hdvlevel);
let tour_sorcier4levelmax = tour_sorcier4_nv_max_hdv(hdvlevel);
let tour_sorcier5levelmax = tour_sorcier5_nv_max_hdv(hdvlevel);

export function calculerPourcentageNiveauxtour_sorciers() {
    // Niveaux actuels
    const niveauxActuels = [
        Math.min(tour_sorcier1level, tour_sorcier1levelmax),
        Math.min(tour_sorcier2level, tour_sorcier2levelmax),
        Math.min(tour_sorcier3level, tour_sorcier3levelmax),
        Math.min(tour_sorcier4level, tour_sorcier4levelmax),
        Math.min(tour_sorcier5level, tour_sorcier5levelmax)
    ];

    // Niveaux max possibles selon HDV
    const niveauxMax = [
        tour_sorcier1levelmax,
        tour_sorcier2levelmax,
        tour_sorcier3levelmax,
        tour_sorcier4levelmax,
        tour_sorcier5levelmax
    ];

    // Calcul des totaux
    const totalMax = niveauxMax.reduce((a, b) => a + b, 0);
    const totalActuel = niveauxActuels.reduce((a, b) => a + b, 0);

    if (totalMax === 0) return 0; // Évite la division par zéro

    const progression = (totalActuel / totalMax) * 100;
    return parseFloat(progression.toFixed(2)); // Limite a 2 décimales
}

export function globalcalculertempsRestanttour_sorciers() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const tour_sorcier1level = parseInt(gettour_sorcierLevel(1), 10);
    const tour_sorcier2level = parseInt(gettour_sorcierLevel(2), 10);
    const tour_sorcier3level = parseInt(gettour_sorcierLevel(3), 10);
    const tour_sorcier4level = parseInt(gettour_sorcierLevel(4), 10);
    const tour_sorcier5level = parseInt(gettour_sorcierLevel(5), 10);

    const tour_sorcier1levelmax = tour_sorcier1_nv_max_hdv(hdvlevel);
    const tour_sorcier2levelmax = tour_sorcier2_nv_max_hdv(hdvlevel);
    const tour_sorcier3levelmax = tour_sorcier3_nv_max_hdv(hdvlevel);
    const tour_sorcier4levelmax = tour_sorcier4_nv_max_hdv(hdvlevel);
    const tour_sorcier5levelmax = tour_sorcier5_nv_max_hdv(hdvlevel);

    let tempsRestant = 0;
    tempsRestant += calculerTempsRestanttour_sorcier1(tour_sorcier1level, tour_sorcier1levelmax);
    tempsRestant += calculerTempsRestanttour_sorcier2(tour_sorcier2level, tour_sorcier2levelmax);
    tempsRestant += calculerTempsRestanttour_sorcier3(tour_sorcier3level, tour_sorcier3levelmax);
    tempsRestant += calculerTempsRestanttour_sorcier4(tour_sorcier4level, tour_sorcier4levelmax);
    tempsRestant += calculerTempsRestanttour_sorcier5(tour_sorcier5level, tour_sorcier5levelmax);

    return tempsRestant;
}

export function globalcalculertempsTotaltour_sorciers() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsTotaltour_sorcier1(tour_sorcier1level);
    tempsTotal += calculerTempsTotaltour_sorcier2(tour_sorcier2level);
    tempsTotal += calculerTempsTotaltour_sorcier3(tour_sorcier3level);
    tempsTotal += calculerTempsTotaltour_sorcier4(tour_sorcier4level);
    tempsTotal += calculerTempsTotaltour_sorcier5(tour_sorcier5level);
    return tempsTotal;
}

export function globalcalculertempsdepuisHDVtour_sorciers() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsdepuisHDVtour_sorcier1(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVtour_sorcier2(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVtour_sorcier3(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVtour_sorcier4(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVtour_sorcier5(hdvlevel);
    return tempsTotal;
}

export function globalcalculertempsConstructionParHDVtour_sorciers() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsConstructionParHDVtour_sorcier1(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVtour_sorcier2(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVtour_sorcier3(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVtour_sorcier4(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVtour_sorcier5(hdvlevel);
    return tempsTotal;
}

export function barredeprogressiontempstour_sorciers() {
    const tempsTotal = globalcalculertempsTotaltour_sorciers();
    const tempsRestant = globalcalculertempsRestanttour_sorciers();
    const tempsConstructionHDV = globalcalculertempsConstructionParHDVtour_sorciers();

    if (tempsTotal === 0) {
        return 0; // Évite la division par zéro
    }

    if (tempsTotal >= tempsConstructionHDV) {
        const progression = ((tempsTotal - tempsRestant) / tempsTotal) * 100;
        return progression.toFixed(2);
    } else {
        // Ajout d'une tolérance pour éviter des valeurs négatives excessives
        const difference = tempsConstructionHDV - tempsTotal;
        if (difference < 0.01 * tempsConstructionHDV) { // Tolérance de 1%
            return 0; // Considérer comme aucune progression négative
        }
        const retard = (difference / tempsConstructionHDV) * 100;
        return (-retard).toFixed(2);
    }
}

export function globalcalculerPrixTotaltour_sorcier() {
    let couttotal = 0;
    couttotal += calculerPrixTotaltour_sorcier1(tour_sorcier1level);
    couttotal += calculerPrixTotaltour_sorcier2(tour_sorcier2level);
    couttotal += calculerPrixTotaltour_sorcier3(tour_sorcier3level);
    couttotal += calculerPrixTotaltour_sorcier4(tour_sorcier4level);
    couttotal += calculerPrixTotaltour_sorcier5(tour_sorcier5level);
    return couttotal;
}

export function globalcalculerPrixRestanttour_sorcier() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const tour_sorcier1level = parseInt(gettour_sorcierLevel(1), 10);
    const tour_sorcier2level = parseInt(gettour_sorcierLevel(2), 10);
    const tour_sorcier3level = parseInt(gettour_sorcierLevel(3), 10);
    const tour_sorcier4level = parseInt(gettour_sorcierLevel(4), 10);
    const tour_sorcier5level = parseInt(gettour_sorcierLevel(5), 10);

    const tour_sorcier1levelmax = tour_sorcier1_nv_max_hdv(hdvlevel);
    const tour_sorcier2levelmax = tour_sorcier2_nv_max_hdv(hdvlevel);
    const tour_sorcier3levelmax = tour_sorcier3_nv_max_hdv(hdvlevel);
    const tour_sorcier4levelmax = tour_sorcier4_nv_max_hdv(hdvlevel);
    const tour_sorcier5levelmax = tour_sorcier5_nv_max_hdv(hdvlevel);

    let coutrestant = 0;
    coutrestant += calculerPrixRestanttour_sorcier1(tour_sorcier1level, tour_sorcier1levelmax);
    coutrestant += calculerPrixRestanttour_sorcier2(tour_sorcier2level, tour_sorcier2levelmax);
    coutrestant += calculerPrixRestanttour_sorcier3(tour_sorcier3level, tour_sorcier3levelmax);
    coutrestant += calculerPrixRestanttour_sorcier4(tour_sorcier4level, tour_sorcier4levelmax);
    coutrestant += calculerPrixRestanttour_sorcier5(tour_sorcier5level, tour_sorcier5levelmax);
    return coutrestant;
}

export function globalcalculerPrixdepuisHDVtour_sorcier() {
    let couttotal = 0;
    couttotal += calculerPrixdepuisHDVtour_sorcier1(hdvlevel);
    couttotal += calculerPrixdepuisHDVtour_sorcier2(hdvlevel);
    couttotal += calculerPrixdepuisHDVtour_sorcier3(hdvlevel);
    couttotal += calculerPrixdepuisHDVtour_sorcier4(hdvlevel);
    couttotal += calculerPrixdepuisHDVtour_sorcier5(hdvlevel);
    return couttotal;
}

export function globalcalculerPrixConstructionParHDVtour_sorcier() {
    let couttotal = 0;
    couttotal += calculerPrixConstructionParHDVtour_sorcier1(hdvlevel);
    couttotal += calculerPrixConstructionParHDVtour_sorcier2(hdvlevel);
    couttotal += calculerPrixConstructionParHDVtour_sorcier3(hdvlevel);
    couttotal += calculerPrixConstructionParHDVtour_sorcier4(hdvlevel);
    couttotal += calculerPrixConstructionParHDVtour_sorcier5(hdvlevel);
    return couttotal;
}

export function barredeprogrssionprixtour_sorciers () {
    const prixTotal = globalcalculerprixTotaltour_sorciers();
    const prixRestant = globalcalculerprixRestanttour_sorciers();
    const prixConstructionHDV = globalcalculerprixConstructionParHDVtour_sorciers();
    if (prixTotal > prixConstructionHDV) {
        let progression = ((prixTotal - prixRestant) / prixTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((prixConstructionHDV - prixTotal) / prixTotal) * 100;
        return (-retard).toFixed(2);
    }
}


export function globalcalculerExperienceTotaltour_sorcier() {
    let expTotal = 0;
    expTotal += calculerExperienceTotaltour_sorcier1(tour_sorcier1level);
    expTotal += calculerExperienceTotaltour_sorcier2(tour_sorcier2level);
    expTotal += calculerExperienceTotaltour_sorcier3(tour_sorcier3level);
    expTotal += calculerExperienceTotaltour_sorcier4(tour_sorcier4level);
    expTotal += calculerExperienceTotaltour_sorcier5(tour_sorcier5level);
    return expTotal;
}

export function globalcalculerExperienceRestanttour_sorcier() {
    let exprestant = 0;
    exprestant += calculerExperienceRestanttour_sorcier1(tour_sorcier1level, tour_sorcier1levelmax);
    exprestant += calculerExperienceRestanttour_sorcier2(tour_sorcier2level, tour_sorcier2levelmax);
    exprestant += calculerExperienceRestanttour_sorcier3(tour_sorcier3level, tour_sorcier3levelmax);
    exprestant += calculerExperienceRestanttour_sorcier4(tour_sorcier4level, tour_sorcier4levelmax);
    exprestant += calculerExperienceRestanttour_sorcier5(tour_sorcier5level, tour_sorcier5levelmax);
    return exprestant;
}

export function globalcalculerExperiencedepuisHDVtour_sorcier() {
    let exptotal = 0;
    exptotal += calculerExperiencedepuisHDVtour_sorcier1(hdvlevel);
    exptotal += calculerExperiencedepuisHDVtour_sorcier2(hdvlevel);
    exptotal += calculerExperiencedepuisHDVtour_sorcier3(hdvlevel);
    exptotal += calculerExperiencedepuisHDVtour_sorcier4(hdvlevel);
    exptotal += calculerExperiencedepuisHDVtour_sorcier5(hdvlevel);
    return exptotal;
}

export function globalcalculerExperienceConstructionParHDVtour_sorcier() {
    let exptotal = 0;
    exptotal += calculerExperienceConstructionParHDVtour_sorcier1(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVtour_sorcier2(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVtour_sorcier3(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVtour_sorcier4(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVtour_sorcier5(hdvlevel);
    return exptotal;
}

export function barredeprogressionexptour_sorciers() {
    const expTotal = globalcalculerExperienceTotaltour_sorcier();
    const expRestant = globalcalculerExperienceRestanttour_sorcier();
    const expConstructionHDV = globalcalculerExperienceConstructionParHDVtour_sorcier();
    if (expTotal > expConstructionHDV) {
        let progression = ((expTotal - expRestant) / expTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((expConstructionHDV - expTotal) / expTotal) * 100;
        return (-retard).toFixed(2);
    }
}

// Fonction pour mettre à jour la barre de progression
function updatetour_sorcierProgress() {
    // Recalculer le niveau de l'Hôtel de Ville
    hdvlevel = getHDVLevel();

    // Recalculer les niveaux des tour_sorciers
    tour_sorcier1level = gettour_sorcierLevel(1);
    tour_sorcier2level = gettour_sorcierLevel(2);
    tour_sorcier3level = gettour_sorcierLevel(3);
    tour_sorcier4level = gettour_sorcierLevel(4);
    tour_sorcier5level = gettour_sorcierLevel(5);

    // Recalculer les niveaux maximums des tour_sorciers en fonction du niveau HDV
    tour_sorcier1levelmax = tour_sorcier1_nv_max_hdv(hdvlevel);
    tour_sorcier2levelmax = tour_sorcier2_nv_max_hdv(hdvlevel);
    tour_sorcier3levelmax = tour_sorcier3_nv_max_hdv(hdvlevel);
    tour_sorcier4levelmax = tour_sorcier4_nv_max_hdv(hdvlevel);
    tour_sorcier5levelmax = tour_sorcier5_nv_max_hdv(hdvlevel);
    // Calculer le pourcentage de progression
    const progression = calculerPourcentageNiveauxtour_sorciers();

    // Mettre à jour la barre de progression et le texte
    const progressBar = document.getElementById('progress-tour_sorciers');
    const progressText = document.getElementById('progress-tour_sorciers-value');
    const progressTimeText = document.getElementById('progress-tour_sorciers-temps');
    const progressPriceText = document.getElementById('progress-tour_sorciers-prix-or');

    if (progressBar && progressText) {
        progressBar.value = progression;
        progressText.textContent = `${progression.toFixed(2)}%`; // Limiter à 2 décimales
    }
    if (progressTimeText) {
        const tempsRestant = globalcalculertempsRestanttour_sorciers();
        progressTimeText.innerHTML = `${convertirSecondescompact(tempsRestant)} <img src="/coc/image/général/ressource/temps icone.png" alt="temps" class="icone-ressource">`;
    }
    if (progressPriceText) {
        const prixRestant = globalcalculerPrixRestanttour_sorcier();
        progressPriceText.innerHTML = `${formatPrix(prixRestant)} <img src="/coc/image/village principal/ressource/or village-p.jpg" alt="or" class="icone-ressource">`;
    }
}

// Ajouter des écouteurs d'événements pour détecter les changements
document.addEventListener('DOMContentLoaded', () => {
    const tour_sorcierSelects = [
        document.getElementById('tour_sorcier1'),
        document.getElementById('tour_sorcier2'),
        document.getElementById('tour_sorcier3'),
        document.getElementById('tour_sorcier4'),
        document.getElementById('tour_sorcier5'),
    ];

    // Ajouter un écouteur pour chaque tour_sorcier
    tour_sorcierSelects.forEach(select => {
        if (select) {
            select.addEventListener('change', updatetour_sorcierProgress);
        }
    });

    // Ajouter un écouteur pour le changement du niveau HDV
    const hdvSelect = document.getElementById('hdv');
    if (hdvSelect) {
        hdvSelect.addEventListener('change', updatetour_sorcierProgress);
    }

    // Initialiser la barre de progression au chargement
    updatetour_sorcierProgress();
});