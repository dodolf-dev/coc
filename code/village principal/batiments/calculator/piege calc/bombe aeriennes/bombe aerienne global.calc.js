import { bombe_aerienne1_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { bombe_aerienne2_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { bombe_aerienne3_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { bombe_aerienne4_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { bombe_aerienne5_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { bombe_aerienne6_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { bombe_aerienne7_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerTempsTotalbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerTempsTotalbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerTempsTotalbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerTempsTotalbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerTempsTotalbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerTempsTotalbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerTempsTotalbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerTempsRestantbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";    
import { calculerTempsRestantbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerTempsRestantbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerTempsRestantbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerTempsRestantbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerTempsRestantbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerTempsRestantbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerTempsdepuisHDVbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerTempsdepuisHDVbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerTempsdepuisHDVbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerTempsdepuisHDVbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerTempsdepuisHDVbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerTempsdepuisHDVbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerTempsdepuisHDVbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerTempsConstructionParHDVbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerTempsConstructionParHDVbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerTempsConstructionParHDVbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerTempsConstructionParHDVbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerTempsConstructionParHDVbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerTempsConstructionParHDVbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerTempsConstructionParHDVbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerPrixTotalbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerPrixTotalbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerPrixTotalbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerPrixTotalbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerPrixTotalbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerPrixTotalbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerPrixTotalbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerPrixRestantbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerPrixRestantbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerPrixRestantbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerPrixRestantbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerPrixRestantbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerPrixRestantbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerPrixRestantbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerPrixdepuisHDVbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerPrixdepuisHDVbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerPrixdepuisHDVbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerPrixdepuisHDVbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerPrixdepuisHDVbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerPrixdepuisHDVbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerPrixdepuisHDVbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerPrixConstructionParHDVbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerPrixConstructionParHDVbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerPrixConstructionParHDVbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerPrixConstructionParHDVbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerPrixConstructionParHDVbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerPrixConstructionParHDVbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerPrixConstructionParHDVbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerExperienceTotalbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerExperienceTotalbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerExperienceTotalbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerExperienceTotalbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerExperienceTotalbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerExperienceTotalbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerExperienceTotalbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerExperienceRestantbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerExperienceRestantbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerExperienceRestantbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerExperienceRestantbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerExperienceRestantbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerExperienceRestantbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerExperienceRestantbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerExperiencedepuisHDVbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerExperiencedepuisHDVbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerExperiencedepuisHDVbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerExperiencedepuisHDVbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerExperiencedepuisHDVbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerExperiencedepuisHDVbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerExperiencedepuisHDVbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { calculerExperienceConstructionParHDVbombe_aerienne1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne1.calc.js";
import { calculerExperienceConstructionParHDVbombe_aerienne2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne2.calc.js";
import { calculerExperienceConstructionParHDVbombe_aerienne3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne3.calc.js";
import { calculerExperienceConstructionParHDVbombe_aerienne4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne4.calc.js";
import { calculerExperienceConstructionParHDVbombe_aerienne5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne5.calc.js";
import { calculerExperienceConstructionParHDVbombe_aerienne6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne6.calc.js";
import { calculerExperienceConstructionParHDVbombe_aerienne7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombe aeriennes/bombe aerienne7.calc.js";

import { formatPrix } from "/coc/code/outils/affichge nombre.js";
import { convertirSecondescompact } from "/coc/code/outils/convertisseurtemps.js";

function getHDVLevel() {
    return document.getElementById("hdv").value;
}

function getbombe_aerienneLevel(num) {
    return document.getElementById(`bombe_aerienne${num}`).value;
}

let hdvlevel = getHDVLevel(); // Récupérer le niveau de l'Hôtel de Ville

let bombe_aerienne1level = getbombe_aerienneLevel(1);
let bombe_aerienne2level = getbombe_aerienneLevel(2);
let bombe_aerienne3level = getbombe_aerienneLevel(3);
let bombe_aerienne4level = getbombe_aerienneLevel(4);
let bombe_aerienne5level = getbombe_aerienneLevel(5);
let bombe_aerienne6level = getbombe_aerienneLevel(6);
let bombe_aerienne7level = getbombe_aerienneLevel(7);

let bombe_aerienne1levelmax = bombe_aerienne1_nv_max_hdv(hdvlevel);
let bombe_aerienne2levelmax = bombe_aerienne2_nv_max_hdv(hdvlevel);
let bombe_aerienne3levelmax = bombe_aerienne3_nv_max_hdv(hdvlevel);
let bombe_aerienne4levelmax = bombe_aerienne4_nv_max_hdv(hdvlevel);
let bombe_aerienne5levelmax = bombe_aerienne5_nv_max_hdv(hdvlevel);
let bombe_aerienne6levelmax = bombe_aerienne6_nv_max_hdv(hdvlevel);
let bombe_aerienne7levelmax = bombe_aerienne7_nv_max_hdv(hdvlevel);

export function calculerPourcentageNiveauxbombe_aeriennes() {
    // Niveaux actuels
    const niveauxActuels = [
        Math.min(bombe_aerienne1level, bombe_aerienne1levelmax),
        Math.min(bombe_aerienne2level, bombe_aerienne2levelmax),
        Math.min(bombe_aerienne3level, bombe_aerienne3levelmax),
        Math.min(bombe_aerienne4level, bombe_aerienne4levelmax),
        Math.min(bombe_aerienne5level, bombe_aerienne5levelmax),
        Math.min(bombe_aerienne6level, bombe_aerienne6levelmax),
        Math.min(bombe_aerienne7level, bombe_aerienne7levelmax),
    ];

    // Niveaux max possibles selon HDV
    const niveauxMax = [
        bombe_aerienne1levelmax,
        bombe_aerienne2levelmax,
        bombe_aerienne3levelmax,
        bombe_aerienne4levelmax,
        bombe_aerienne5levelmax,
        bombe_aerienne6levelmax,
        bombe_aerienne7levelmax,
    ];

    // Calcul des totaux
    const totalMax = niveauxMax.reduce((a, b) => a + b, 0);
    const totalActuel = niveauxActuels.reduce((a, b) => a + b, 0);

    if (totalMax === 0) return 0; // Évite la division par zéro

    const progression = (totalActuel / totalMax) * 100;
    return parseFloat(progression.toFixed(2)); // Limite a 2 décimales
}

export function globalcalculertempsRestantbombe_aeriennes() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const bombe_aerienne1level = parseInt(getbombe_aerienneLevel(1), 10);
    const bombe_aerienne2level = parseInt(getbombe_aerienneLevel(2), 10);
    const bombe_aerienne3level = parseInt(getbombe_aerienneLevel(3), 10);
    const bombe_aerienne4level = parseInt(getbombe_aerienneLevel(4), 10);
    const bombe_aerienne5level = parseInt(getbombe_aerienneLevel(5), 10);
    const bombe_aerienne6level = parseInt(getbombe_aerienneLevel(6), 10);
    const bombe_aerienne7level = parseInt(getbombe_aerienneLevel(7), 10);

    const bombe_aerienne1levelmax = bombe_aerienne1_nv_max_hdv(hdvlevel);
    const bombe_aerienne2levelmax = bombe_aerienne2_nv_max_hdv(hdvlevel);
    const bombe_aerienne3levelmax = bombe_aerienne3_nv_max_hdv(hdvlevel);
    const bombe_aerienne4levelmax = bombe_aerienne4_nv_max_hdv(hdvlevel);
    const bombe_aerienne5levelmax = bombe_aerienne5_nv_max_hdv(hdvlevel);
    const bombe_aerienne6levelmax = bombe_aerienne6_nv_max_hdv(hdvlevel);
    const bombe_aerienne7levelmax = bombe_aerienne7_nv_max_hdv(hdvlevel);

    let tempsRestant = 0;
    tempsRestant += calculerTempsRestantbombe_aerienne1(bombe_aerienne1level, bombe_aerienne1levelmax);
    tempsRestant += calculerTempsRestantbombe_aerienne2(bombe_aerienne2level, bombe_aerienne2levelmax);
    tempsRestant += calculerTempsRestantbombe_aerienne3(bombe_aerienne3level, bombe_aerienne3levelmax);
    tempsRestant += calculerTempsRestantbombe_aerienne4(bombe_aerienne4level, bombe_aerienne4levelmax);
    tempsRestant += calculerTempsRestantbombe_aerienne5(bombe_aerienne5level, bombe_aerienne5levelmax);
    tempsRestant += calculerTempsRestantbombe_aerienne6(bombe_aerienne6level, bombe_aerienne6levelmax);
    tempsRestant += calculerTempsRestantbombe_aerienne7(bombe_aerienne7level, bombe_aerienne7levelmax);
    return tempsRestant;
}

export function globalcalculertempsTotalbombe_aeriennes() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsTotalbombe_aerienne1(bombe_aerienne1level);
    tempsTotal += calculerTempsTotalbombe_aerienne2(bombe_aerienne2level);
    tempsTotal += calculerTempsTotalbombe_aerienne3(bombe_aerienne3level);
    tempsTotal += calculerTempsTotalbombe_aerienne4(bombe_aerienne4level);
    tempsTotal += calculerTempsTotalbombe_aerienne5(bombe_aerienne5level);
    tempsTotal += calculerTempsTotalbombe_aerienne6(bombe_aerienne6level);
    tempsTotal += calculerTempsTotalbombe_aerienne7(bombe_aerienne7level);
    return tempsTotal;
}

export function globalcalculertempsdepuisHDVbombe_aeriennes() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsdepuisHDVbombe_aerienne1(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe_aerienne2(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe_aerienne3(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe_aerienne4(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe_aerienne5(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe_aerienne6(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe_aerienne7(hdvlevel);
    return tempsTotal;
}

export function globalcalculertempsConstructionParHDVbombe_aeriennes() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsConstructionParHDVbombe_aerienne1(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe_aerienne2(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe_aerienne3(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe_aerienne4(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe_aerienne5(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe_aerienne6(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe_aerienne7(hdvlevel);
    return tempsTotal;
}

export function barredeprogressiontempsbombe_aeriennes() {
    const tempsTotal = globalcalculertempsTotalbombe_aeriennes();
    const tempsRestant = globalcalculertempsRestantbombe_aeriennes();
    const tempsConstructionHDV = globalcalculertempsConstructionParHDVbombe_aeriennes();

    if (tempsTotal === 0) {
        return 0; // Évite la division par zéro
    }

    if (tempsTotal >= tempsConstructionHDV) {
        const progression = ((tempsTotal - tempsRestant) / tempsTotal) * 100;
        return progression.toFixed(2);
    } else {
        // Ajout d'une tolérance pour éviter des valeurs négatives excessives
        const difference = tempsConstructionHDV - tempsTotal;
        if (difference < 0.01 * tempsConstructionHDV) { // Tolérance de 1%
            return 0; // Considérer comme aucune progression négative
        }
        const retard = (difference / tempsConstructionHDV) * 100;
        return (-retard).toFixed(2);
    }
}

export function globalcalculerPrixTotalbombe_aerienne() {
    let couttotal = 0;
    couttotal += calculerPrixTotalbombe_aerienne1(bombe_aerienne1level);
    couttotal += calculerPrixTotalbombe_aerienne2(bombe_aerienne2level);
    couttotal += calculerPrixTotalbombe_aerienne3(bombe_aerienne3level);
    couttotal += calculerPrixTotalbombe_aerienne4(bombe_aerienne4level);
    couttotal += calculerPrixTotalbombe_aerienne5(bombe_aerienne5level);
    couttotal += calculerPrixTotalbombe_aerienne6(bombe_aerienne6level);
    couttotal += calculerPrixTotalbombe_aerienne7(bombe_aerienne7level);
    return couttotal;
}

export function globalcalculerPrixRestantbombe_aerienne() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const bombe_aerienne1level = parseInt(getbombe_aerienneLevel(1), 10);
    const bombe_aerienne2level = parseInt(getbombe_aerienneLevel(2), 10);
    const bombe_aerienne3level = parseInt(getbombe_aerienneLevel(3), 10);
    const bombe_aerienne4level = parseInt(getbombe_aerienneLevel(4), 10);
    const bombe_aerienne5level = parseInt(getbombe_aerienneLevel(5), 10);
    const bombe_aerienne6level = parseInt(getbombe_aerienneLevel(6), 10);
    const bombe_aerienne7level = parseInt(getbombe_aerienneLevel(7), 10);

    const bombe_aerienne1levelmax = bombe_aerienne1_nv_max_hdv(hdvlevel);
    const bombe_aerienne2levelmax = bombe_aerienne2_nv_max_hdv(hdvlevel);
    const bombe_aerienne3levelmax = bombe_aerienne3_nv_max_hdv(hdvlevel);
    const bombe_aerienne4levelmax = bombe_aerienne4_nv_max_hdv(hdvlevel);
    const bombe_aerienne5levelmax = bombe_aerienne5_nv_max_hdv(hdvlevel);
    const bombe_aerienne6levelmax = bombe_aerienne6_nv_max_hdv(hdvlevel);
    const bombe_aerienne7levelmax = bombe_aerienne7_nv_max_hdv(hdvlevel);

    let coutrestant = 0;
    coutrestant += calculerPrixRestantbombe_aerienne1(bombe_aerienne1level, bombe_aerienne1levelmax);
    coutrestant += calculerPrixRestantbombe_aerienne2(bombe_aerienne2level, bombe_aerienne2levelmax);
    coutrestant += calculerPrixRestantbombe_aerienne3(bombe_aerienne3level, bombe_aerienne3levelmax);
    coutrestant += calculerPrixRestantbombe_aerienne4(bombe_aerienne4level, bombe_aerienne4levelmax);
    coutrestant += calculerPrixRestantbombe_aerienne5(bombe_aerienne5level, bombe_aerienne5levelmax);
    coutrestant += calculerPrixRestantbombe_aerienne6(bombe_aerienne6level, bombe_aerienne6levelmax);
    coutrestant += calculerPrixRestantbombe_aerienne7(bombe_aerienne7level, bombe_aerienne7levelmax);
    return coutrestant;
}

export function globalcalculerPrixdepuisHDVbombe_aerienne() {
    let couttotal = 0;
    couttotal += calculerPrixdepuisHDVbombe_aerienne1(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe_aerienne2(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe_aerienne3(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe_aerienne4(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe_aerienne5(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe_aerienne6(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe_aerienne7(hdvlevel);
    return couttotal;
}

export function globalcalculerPrixConstructionParHDVbombe_aerienne() {
    let couttotal = 0;
    couttotal += calculerPrixConstructionParHDVbombe_aerienne1(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe_aerienne2(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe_aerienne3(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe_aerienne4(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe_aerienne5(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe_aerienne6(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe_aerienne7(hdvlevel);
    return couttotal;
}

export function barredeprogrssionprixbombe_aeriennes () {
    const prixTotal = globalcalculerprixTotalbombe_aeriennes();
    const prixRestant = globalcalculerprixRestantbombe_aeriennes();
    const prixConstructionHDV = globalcalculerprixConstructionParHDVbombe_aeriennes();
    if (prixTotal > prixConstructionHDV) {
        let progression = ((prixTotal - prixRestant) / prixTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((prixConstructionHDV - prixTotal) / prixTotal) * 100;
        return (-retard).toFixed(2);
    }
}


export function globalcalculerExperienceTotalbombe_aerienne() {
    let expTotal = 0;
    expTotal += calculerExperienceTotalbombe_aerienne1(bombe_aerienne1level);
    expTotal += calculerExperienceTotalbombe_aerienne2(bombe_aerienne2level);
    expTotal += calculerExperienceTotalbombe_aerienne3(bombe_aerienne3level);
    expTotal += calculerExperienceTotalbombe_aerienne4(bombe_aerienne4level);
    expTotal += calculerExperienceTotalbombe_aerienne5(bombe_aerienne5level);
    expTotal += calculerExperienceTotalbombe_aerienne6(bombe_aerienne6level);
    expTotal += calculerExperienceTotalbombe_aerienne7(bombe_aerienne7level);
    return expTotal;
}

export function globalcalculerExperienceRestantbombe_aerienne() {
    let exprestant = 0;
    exprestant += calculerExperienceRestantbombe_aerienne1(bombe_aerienne1level, bombe_aerienne1levelmax);
    exprestant += calculerExperienceRestantbombe_aerienne2(bombe_aerienne2level, bombe_aerienne2levelmax);
    exprestant += calculerExperienceRestantbombe_aerienne3(bombe_aerienne3level, bombe_aerienne3levelmax);
    exprestant += calculerExperienceRestantbombe_aerienne4(bombe_aerienne4level, bombe_aerienne4levelmax);
    exprestant += calculerExperienceRestantbombe_aerienne5(bombe_aerienne5level, bombe_aerienne5levelmax);
    exprestant += calculerExperienceRestantbombe_aerienne6(bombe_aerienne6level, bombe_aerienne6levelmax);
    exprestant += calculerExperienceRestantbombe_aerienne7(bombe_aerienne7level, bombe_aerienne7levelmax);
    return exprestant;
}

export function globalcalculerExperiencedepuisHDVbombe_aerienne() {
    let exptotal = 0;
    exptotal += calculerExperiencedepuisHDVbombe_aerienne1(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe_aerienne2(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe_aerienne3(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe_aerienne4(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe_aerienne5(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe_aerienne6(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe_aerienne7(hdvlevel);
    return exptotal;
}

export function globalcalculerExperienceConstructionParHDVbombe_aerienne() {
    let exptotal = 0;
    exptotal += calculerExperienceConstructionParHDVbombe_aerienne1(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe_aerienne2(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe_aerienne3(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe_aerienne4(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe_aerienne5(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe_aerienne6(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe_aerienne7(hdvlevel);
    return exptotal;
}

export function barredeprogressionexpbombe_aeriennes() {
    const expTotal = globalcalculerExperienceTotalbombe_aerienne();
    const expRestant = globalcalculerExperienceRestantbombe_aerienne();
    const expConstructionHDV = globalcalculerExperienceConstructionParHDVbombe_aerienne();
    if (expTotal > expConstructionHDV) {
        let progression = ((expTotal - expRestant) / expTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((expConstructionHDV - expTotal) / expTotal) * 100;
        return (-retard).toFixed(2);
    }
}

// Fonction pour mettre à jour la barre de progression
function updatebombe_aerienneProgress() {
    // Recalculer le niveau de l'Hôtel de Ville
    hdvlevel = getHDVLevel();

    // Recalculer les niveaux des bombe_aeriennes
    bombe_aerienne1level = getbombe_aerienneLevel(1);
    bombe_aerienne2level = getbombe_aerienneLevel(2);
    bombe_aerienne3level = getbombe_aerienneLevel(3);
    bombe_aerienne4level = getbombe_aerienneLevel(4);
    bombe_aerienne5level = getbombe_aerienneLevel(5);
    bombe_aerienne6level = getbombe_aerienneLevel(6);
    bombe_aerienne7level = getbombe_aerienneLevel(7);

    // Recalculer les niveaux maximums des bombe_aeriennes en fonction du niveau HDV
    bombe_aerienne1levelmax = bombe_aerienne1_nv_max_hdv(hdvlevel);
    bombe_aerienne2levelmax = bombe_aerienne2_nv_max_hdv(hdvlevel);
    bombe_aerienne3levelmax = bombe_aerienne3_nv_max_hdv(hdvlevel);
    bombe_aerienne4levelmax = bombe_aerienne4_nv_max_hdv(hdvlevel);
    bombe_aerienne5levelmax = bombe_aerienne5_nv_max_hdv(hdvlevel);
    bombe_aerienne6levelmax = bombe_aerienne6_nv_max_hdv(hdvlevel);
    bombe_aerienne7levelmax = bombe_aerienne7_nv_max_hdv(hdvlevel);
    // Calculer le pourcentage de progression
    const progression = calculerPourcentageNiveauxbombe_aeriennes();

    // Mettre à jour la barre de progression et le texte
    const progressBar = document.getElementById('progress-bombe_aeriennes');
    const progressText = document.getElementById('progress-bombe_aeriennes-value');
    const progressTimeText = document.getElementById('progress-bombe_aeriennes-temps');
    const progressPriceText = document.getElementById('progress-bombe_aeriennes-prix-or');

    if (progressBar && progressText) {
        progressBar.value = progression;
        progressText.textContent = `${progression.toFixed(2)}%`; // Limiter à 2 décimales
    }
    if (progressTimeText) {
        const tempsRestant = globalcalculertempsRestantbombe_aeriennes();
        if (tempsRestant === 0) {
            progressTimeText.style.display = "none";
        }
        else {
            progressTimeText.style.display = "";
            progressTimeText.innerHTML = `${convertirSecondescompact(tempsRestant)} <img src="/coc/image/général/ressource/temps icone.png" alt="temps" class="icone-ressource">`;
        }
    }
    if (progressPriceText) {
        const prixRestant = globalcalculerPrixRestantbombe_aerienne();
        if (prixRestant === 0){
            progressPriceText.style.display = "none";
        }
        else {
            progressPriceText.style.display = "";
            progressPriceText.innerHTML = `${formatPrix(prixRestant)} <img src="/coc/image/village principal/ressource/or village-p.jpg" alt="or" class="icone-ressource">`;
        }
    }
}

// Ajouter des écouteurs d'événements pour détecter les changements
document.addEventListener('DOMContentLoaded', () => {
    const bombe_aerienneSelects = [
        document.getElementById('bombe_aerienne1'),
        document.getElementById('bombe_aerienne2'),
        document.getElementById('bombe_aerienne3'),
        document.getElementById('bombe_aerienne4'),
        document.getElementById('bombe_aerienne5'),
        document.getElementById('bombe_aerienne6'),
        document.getElementById('bombe_aerienne7'),
    ];

    // Ajouter un écouteur pour chaque bombe_aerienne
    bombe_aerienneSelects.forEach(select => {
        if (select) {
            select.addEventListener('change', updatebombe_aerienneProgress);
        }
    });

    // Ajouter un écouteur pour le changement du niveau HDV
    const hdvSelect = document.getElementById('hdv');
    if (hdvSelect) {
        hdvSelect.addEventListener('change', updatebombe_aerienneProgress);
    }

    // Initialiser la barre de progression au chargement
    updatebombe_aerienneProgress();
});