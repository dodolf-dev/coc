import { bombe1_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { bombe2_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { bombe3_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { bombe4_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { bombe5_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { bombe6_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { bombe7_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { bombe8_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerTempsTotalbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerTempsTotalbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerTempsTotalbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerTempsTotalbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerTempsTotalbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerTempsTotalbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerTempsTotalbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerTempsTotalbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerTempsRestantbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";    
import { calculerTempsRestantbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerTempsRestantbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerTempsRestantbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerTempsRestantbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerTempsRestantbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerTempsRestantbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerTempsRestantbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerTempsdepuisHDVbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerTempsdepuisHDVbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerTempsdepuisHDVbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerTempsdepuisHDVbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerTempsdepuisHDVbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerTempsdepuisHDVbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerTempsdepuisHDVbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerTempsdepuisHDVbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerTempsConstructionParHDVbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerTempsConstructionParHDVbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerTempsConstructionParHDVbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerTempsConstructionParHDVbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerTempsConstructionParHDVbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerTempsConstructionParHDVbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerTempsConstructionParHDVbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerTempsConstructionParHDVbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerPrixTotalbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerPrixTotalbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerPrixTotalbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerPrixTotalbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerPrixTotalbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerPrixTotalbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerPrixTotalbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerPrixTotalbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerPrixRestantbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerPrixRestantbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerPrixRestantbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerPrixRestantbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerPrixRestantbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerPrixRestantbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerPrixRestantbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerPrixRestantbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerPrixdepuisHDVbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerPrixdepuisHDVbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerPrixdepuisHDVbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerPrixdepuisHDVbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerPrixdepuisHDVbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerPrixdepuisHDVbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerPrixdepuisHDVbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerPrixdepuisHDVbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerPrixConstructionParHDVbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerPrixConstructionParHDVbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerPrixConstructionParHDVbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerPrixConstructionParHDVbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerPrixConstructionParHDVbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerPrixConstructionParHDVbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerPrixConstructionParHDVbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerPrixConstructionParHDVbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerExperienceTotalbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerExperienceTotalbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerExperienceTotalbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerExperienceTotalbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerExperienceTotalbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerExperienceTotalbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerExperienceTotalbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerExperienceTotalbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerExperienceRestantbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerExperienceRestantbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerExperienceRestantbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerExperienceRestantbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerExperienceRestantbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerExperienceRestantbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerExperienceRestantbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerExperienceRestantbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerExperiencedepuisHDVbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerExperiencedepuisHDVbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerExperiencedepuisHDVbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerExperiencedepuisHDVbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerExperiencedepuisHDVbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerExperiencedepuisHDVbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerExperiencedepuisHDVbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerExperiencedepuisHDVbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { calculerExperienceConstructionParHDVbombe1 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe1.calc.js";
import { calculerExperienceConstructionParHDVbombe2 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe2.calc.js";
import { calculerExperienceConstructionParHDVbombe3 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe3.calc.js";
import { calculerExperienceConstructionParHDVbombe4 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe4.calc.js";
import { calculerExperienceConstructionParHDVbombe5 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe5.calc.js";
import { calculerExperienceConstructionParHDVbombe6 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe6.calc.js";
import { calculerExperienceConstructionParHDVbombe7 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe7.calc.js";
import { calculerExperienceConstructionParHDVbombe8 } from "/coc/code/village principal/batiments/calculator/piege calc/bombes/bombe8.calc.js";

import { formatPrix } from "/coc/code/outils/affichge nombre.js";
import { convertirSecondescompact } from "/coc/code/outils/convertisseurtemps.js";

function getHDVLevel() {
    return document.getElementById("hdv").value;
}

function getbombeLevel(num) {
    return document.getElementById(`bombe${num}`).value;
}

let hdvlevel = getHDVLevel(); // Récupérer le niveau de l'Hôtel de Ville

let bombe1level = getbombeLevel(1);
let bombe2level = getbombeLevel(2);
let bombe3level = getbombeLevel(3);
let bombe4level = getbombeLevel(4);
let bombe5level = getbombeLevel(5);
let bombe6level = getbombeLevel(6);
let bombe7level = getbombeLevel(7);
let bombe8level = getbombeLevel(8);

let bombe1levelmax = bombe1_nv_max_hdv(hdvlevel);
let bombe2levelmax = bombe2_nv_max_hdv(hdvlevel);
let bombe3levelmax = bombe3_nv_max_hdv(hdvlevel);
let bombe4levelmax = bombe4_nv_max_hdv(hdvlevel);
let bombe5levelmax = bombe5_nv_max_hdv(hdvlevel);
let bombe6levelmax = bombe6_nv_max_hdv(hdvlevel);
let bombe7levelmax = bombe7_nv_max_hdv(hdvlevel);
let bombe8levelmax = bombe8_nv_max_hdv(hdvlevel);

export function calculerPourcentageNiveauxbombes() {
    // Niveaux actuels
    const niveauxActuels = [
        Math.min(bombe1level, bombe1levelmax),
        Math.min(bombe2level, bombe2levelmax),
        Math.min(bombe3level, bombe3levelmax),
        Math.min(bombe4level, bombe4levelmax),
        Math.min(bombe5level, bombe5levelmax),
        Math.min(bombe6level, bombe6levelmax),
        Math.min(bombe7level, bombe7levelmax),
        Math.min(bombe8level, bombe8levelmax),
    ];

    // Niveaux max possibles selon HDV
    const niveauxMax = [
        bombe1levelmax,
        bombe2levelmax,
        bombe3levelmax,
        bombe4levelmax,
        bombe5levelmax,
        bombe6levelmax,
        bombe7levelmax,
        bombe8levelmax,
    ];

    // Calcul des totaux
    const totalMax = niveauxMax.reduce((a, b) => a + b, 0);
    const totalActuel = niveauxActuels.reduce((a, b) => a + b, 0);

    if (totalMax === 0) return 0; // Évite la division par zéro

    const progression = (totalActuel / totalMax) * 100;
    return parseFloat(progression.toFixed(2)); // Limite a 2 décimales
}

export function globalcalculertempsRestantbombes() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const bombe1level = parseInt(getbombeLevel(1), 10);
    const bombe2level = parseInt(getbombeLevel(2), 10);
    const bombe3level = parseInt(getbombeLevel(3), 10);
    const bombe4level = parseInt(getbombeLevel(4), 10);
    const bombe5level = parseInt(getbombeLevel(5), 10);
    const bombe6level = parseInt(getbombeLevel(6), 10);
    const bombe7level = parseInt(getbombeLevel(7), 10);
    const bombe8level = parseInt(getbombeLevel(8), 10);

    const bombe1levelmax = bombe1_nv_max_hdv(hdvlevel);
    const bombe2levelmax = bombe2_nv_max_hdv(hdvlevel);
    const bombe3levelmax = bombe3_nv_max_hdv(hdvlevel);
    const bombe4levelmax = bombe4_nv_max_hdv(hdvlevel);
    const bombe5levelmax = bombe5_nv_max_hdv(hdvlevel);
    const bombe6levelmax = bombe6_nv_max_hdv(hdvlevel);
    const bombe7levelmax = bombe7_nv_max_hdv(hdvlevel);
    const bombe8levelmax = bombe8_nv_max_hdv(hdvlevel);

    let tempsRestant = 0;
    tempsRestant += calculerTempsRestantbombe1(bombe1level, bombe1levelmax);
    tempsRestant += calculerTempsRestantbombe2(bombe2level, bombe2levelmax);
    tempsRestant += calculerTempsRestantbombe3(bombe3level, bombe3levelmax);
    tempsRestant += calculerTempsRestantbombe4(bombe4level, bombe4levelmax);
    tempsRestant += calculerTempsRestantbombe5(bombe5level, bombe5levelmax);
    tempsRestant += calculerTempsRestantbombe6(bombe6level, bombe6levelmax);
    tempsRestant += calculerTempsRestantbombe7(bombe7level, bombe7levelmax);
    tempsRestant += calculerTempsRestantbombe8(bombe8level, bombe8levelmax);
    return tempsRestant;
}

export function globalcalculertempsTotalbombes() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsTotalbombe1(bombe1level);
    tempsTotal += calculerTempsTotalbombe2(bombe2level);
    tempsTotal += calculerTempsTotalbombe3(bombe3level);
    tempsTotal += calculerTempsTotalbombe4(bombe4level);
    tempsTotal += calculerTempsTotalbombe5(bombe5level);
    tempsTotal += calculerTempsTotalbombe6(bombe6level);
    tempsTotal += calculerTempsTotalbombe7(bombe7level);
    tempsTotal += calculerTempsTotalbombe8(bombe8level);
    return tempsTotal;
}

export function globalcalculertempsdepuisHDVbombes() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsdepuisHDVbombe1(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe2(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe3(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe4(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe5(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe6(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe7(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVbombe8(hdvlevel);
    return tempsTotal;
}

export function globalcalculertempsConstructionParHDVbombes() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsConstructionParHDVbombe1(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe2(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe3(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe4(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe5(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe6(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe7(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVbombe8(hdvlevel);
    return tempsTotal;
}

export function barredeprogressiontempsbombes() {
    const tempsTotal = globalcalculertempsTotalbombes();
    const tempsRestant = globalcalculertempsRestantbombes();
    const tempsConstructionHDV = globalcalculertempsConstructionParHDVbombes();

    if (tempsTotal === 0) {
        return 0; // Évite la division par zéro
    }

    if (tempsTotal >= tempsConstructionHDV) {
        const progression = ((tempsTotal - tempsRestant) / tempsTotal) * 100;
        return progression.toFixed(2);
    } else {
        // Ajout d'une tolérance pour éviter des valeurs négatives excessives
        const difference = tempsConstructionHDV - tempsTotal;
        if (difference < 0.01 * tempsConstructionHDV) { // Tolérance de 1%
            return 0; // Considérer comme aucune progression négative
        }
        const retard = (difference / tempsConstructionHDV) * 100;
        return (-retard).toFixed(2);
    }
}

export function globalcalculerPrixTotalbombe() {
    let couttotal = 0;
    couttotal += calculerPrixTotalbombe1(bombe1level);
    couttotal += calculerPrixTotalbombe2(bombe2level);
    couttotal += calculerPrixTotalbombe3(bombe3level);
    couttotal += calculerPrixTotalbombe4(bombe4level);
    couttotal += calculerPrixTotalbombe5(bombe5level);
    couttotal += calculerPrixTotalbombe6(bombe6level);
    couttotal += calculerPrixTotalbombe7(bombe7level);
    couttotal += calculerPrixTotalbombe8(bombe8level);
    return couttotal;
}

export function globalcalculerPrixRestantbombe() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const bombe1level = parseInt(getbombeLevel(1), 10);
    const bombe2level = parseInt(getbombeLevel(2), 10);
    const bombe3level = parseInt(getbombeLevel(3), 10);
    const bombe4level = parseInt(getbombeLevel(4), 10);
    const bombe5level = parseInt(getbombeLevel(5), 10);
    const bombe6level = parseInt(getbombeLevel(6), 10);
    const bombe7level = parseInt(getbombeLevel(7), 10);
    const bombe8level = parseInt(getbombeLevel(8), 10);

    const bombe1levelmax = bombe1_nv_max_hdv(hdvlevel);
    const bombe2levelmax = bombe2_nv_max_hdv(hdvlevel);
    const bombe3levelmax = bombe3_nv_max_hdv(hdvlevel);
    const bombe4levelmax = bombe4_nv_max_hdv(hdvlevel);
    const bombe5levelmax = bombe5_nv_max_hdv(hdvlevel);
    const bombe6levelmax = bombe6_nv_max_hdv(hdvlevel);
    const bombe7levelmax = bombe7_nv_max_hdv(hdvlevel);
    const bombe8levelmax = bombe8_nv_max_hdv(hdvlevel);

    let coutrestant = 0;
    coutrestant += calculerPrixRestantbombe1(bombe1level, bombe1levelmax);
    coutrestant += calculerPrixRestantbombe2(bombe2level, bombe2levelmax);
    coutrestant += calculerPrixRestantbombe3(bombe3level, bombe3levelmax);
    coutrestant += calculerPrixRestantbombe4(bombe4level, bombe4levelmax);
    coutrestant += calculerPrixRestantbombe5(bombe5level, bombe5levelmax);
    coutrestant += calculerPrixRestantbombe6(bombe6level, bombe6levelmax);
    coutrestant += calculerPrixRestantbombe7(bombe7level, bombe7levelmax);
    coutrestant += calculerPrixRestantbombe8(bombe8level, bombe8levelmax);
    return coutrestant;
}

export function globalcalculerPrixdepuisHDVbombe() {
    let couttotal = 0;
    couttotal += calculerPrixdepuisHDVbombe1(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe2(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe3(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe4(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe5(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe6(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe7(hdvlevel);
    couttotal += calculerPrixdepuisHDVbombe8(hdvlevel);
    return couttotal;
}

export function globalcalculerPrixConstructionParHDVbombe() {
    let couttotal = 0;
    couttotal += calculerPrixConstructionParHDVbombe1(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe2(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe3(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe4(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe5(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe6(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe7(hdvlevel);
    couttotal += calculerPrixConstructionParHDVbombe8(hdvlevel);
    return couttotal;
}

export function barredeprogrssionprixbombes () {
    const prixTotal = globalcalculerprixTotalbombes();
    const prixRestant = globalcalculerprixRestantbombes();
    const prixConstructionHDV = globalcalculerprixConstructionParHDVbombes();
    if (prixTotal > prixConstructionHDV) {
        let progression = ((prixTotal - prixRestant) / prixTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((prixConstructionHDV - prixTotal) / prixTotal) * 100;
        return (-retard).toFixed(2);
    }
}


export function globalcalculerExperienceTotalbombe() {
    let expTotal = 0;
    expTotal += calculerExperienceTotalbombe1(bombe1level);
    expTotal += calculerExperienceTotalbombe2(bombe2level);
    expTotal += calculerExperienceTotalbombe3(bombe3level);
    expTotal += calculerExperienceTotalbombe4(bombe4level);
    expTotal += calculerExperienceTotalbombe5(bombe5level);
    expTotal += calculerExperienceTotalbombe6(bombe6level);
    expTotal += calculerExperienceTotalbombe7(bombe7level);
    expTotal += calculerExperienceTotalbombe8(bombe8level);
    return expTotal;
}

export function globalcalculerExperienceRestantbombe() {
    let exprestant = 0;
    exprestant += calculerExperienceRestantbombe1(bombe1level, bombe1levelmax);
    exprestant += calculerExperienceRestantbombe2(bombe2level, bombe2levelmax);
    exprestant += calculerExperienceRestantbombe3(bombe3level, bombe3levelmax);
    exprestant += calculerExperienceRestantbombe4(bombe4level, bombe4levelmax);
    exprestant += calculerExperienceRestantbombe5(bombe5level, bombe5levelmax);
    exprestant += calculerExperienceRestantbombe6(bombe6level, bombe6levelmax);
    exprestant += calculerExperienceRestantbombe7(bombe7level, bombe7levelmax);
    exprestant += calculerExperienceRestantbombe8(bombe8level, bombe8levelmax);
    return exprestant;
}

export function globalcalculerExperiencedepuisHDVbombe() {
    let exptotal = 0;
    exptotal += calculerExperiencedepuisHDVbombe1(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe2(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe3(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe4(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe5(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe6(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe7(hdvlevel);
    exptotal += calculerExperiencedepuisHDVbombe8(hdvlevel);
    return exptotal;
}

export function globalcalculerExperienceConstructionParHDVbombe() {
    let exptotal = 0;
    exptotal += calculerExperienceConstructionParHDVbombe1(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe2(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe3(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe4(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe5(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe6(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe7(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVbombe8(hdvlevel);
    return exptotal;
}

export function barredeprogressionexpbombes() {
    const expTotal = globalcalculerExperienceTotalbombe();
    const expRestant = globalcalculerExperienceRestantbombe();
    const expConstructionHDV = globalcalculerExperienceConstructionParHDVbombe();
    if (expTotal > expConstructionHDV) {
        let progression = ((expTotal - expRestant) / expTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((expConstructionHDV - expTotal) / expTotal) * 100;
        return (-retard).toFixed(2);
    }
}

// Fonction pour mettre à jour la barre de progression
function updatebombeProgress() {
    // Recalculer le niveau de l'Hôtel de Ville
    hdvlevel = getHDVLevel();

    // Recalculer les niveaux des bombes
    bombe1level = getbombeLevel(1);
    bombe2level = getbombeLevel(2);
    bombe3level = getbombeLevel(3);
    bombe4level = getbombeLevel(4);
    bombe5level = getbombeLevel(5);
    bombe6level = getbombeLevel(6);
    bombe7level = getbombeLevel(7);
    bombe8level = getbombeLevel(8);

    // Recalculer les niveaux maximums des bombes en fonction du niveau HDV
    bombe1levelmax = bombe1_nv_max_hdv(hdvlevel);
    bombe2levelmax = bombe2_nv_max_hdv(hdvlevel);
    bombe3levelmax = bombe3_nv_max_hdv(hdvlevel);
    bombe4levelmax = bombe4_nv_max_hdv(hdvlevel);
    bombe5levelmax = bombe5_nv_max_hdv(hdvlevel);
    bombe6levelmax = bombe6_nv_max_hdv(hdvlevel);
    bombe7levelmax = bombe7_nv_max_hdv(hdvlevel);
    bombe8levelmax = bombe8_nv_max_hdv(hdvlevel);
    // Calculer le pourcentage de progression
    const progression = calculerPourcentageNiveauxbombes();

    // Mettre à jour la barre de progression et le texte
    const progressBar = document.getElementById('progress-bombes');
    const progressText = document.getElementById('progress-bombes-value');
    const progressTimeText = document.getElementById('progress-bombes-temps');
    const progressPriceText = document.getElementById('progress-bombes-prix-or');

    if (progressBar && progressText) {
        progressBar.value = progression;
        progressText.textContent = `${progression.toFixed(2)}%`; // Limiter à 2 décimales
    }
    if (progressTimeText) {
        const tempsRestant = globalcalculertempsRestantbombes();
        if (tempsRestant === 0) {
            progressTimeText.style.display = "none";
        }
        else {
            progressTimeText.style.display = "";
            progressTimeText.innerHTML = `${convertirSecondescompact(tempsRestant)} <img src="/coc/image/général/ressource/temps icone.png" alt="temps" class="icone-ressource">`;
        }
    }
    if (progressPriceText) {
        const prixRestant = globalcalculerPrixRestantbombe();
        if (prixRestant === 0){
            progressPriceText.style.display = "none";
        }
        else {
            progressPriceText.style.display = "";
            progressPriceText.innerHTML = `${formatPrix(prixRestant)} <img src="/coc/image/village principal/ressource/or village-p.jpg" alt="or" class="icone-ressource">`;
        }
    }
}

// Ajouter des écouteurs d'événements pour détecter les changements
document.addEventListener('DOMContentLoaded', () => {
    const bombeSelects = [
        document.getElementById('bombe1'),
        document.getElementById('bombe2'),
        document.getElementById('bombe3'),
        document.getElementById('bombe4'),
        document.getElementById('bombe5'),
        document.getElementById('bombe6'),
        document.getElementById('bombe7'),
        document.getElementById('bombe8'),
    ];

    // Ajouter un écouteur pour chaque bombe
    bombeSelects.forEach(select => {
        if (select) {
            select.addEventListener('change', updatebombeProgress);
        }
    });

    // Ajouter un écouteur pour le changement du niveau HDV
    const hdvSelect = document.getElementById('hdv');
    if (hdvSelect) {
        hdvSelect.addEventListener('change', updatebombeProgress);
    }

    // Initialiser la barre de progression au chargement
    updatebombeProgress();
});