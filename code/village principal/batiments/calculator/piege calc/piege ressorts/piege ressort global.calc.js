import { piege_ressort1_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { piege_ressort2_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { piege_ressort3_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { piege_ressort4_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { piege_ressort5_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { piege_ressort6_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { piege_ressort7_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { piege_ressort8_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { piege_ressort9_nv_max_hdv } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerTempsTotalpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerTempsTotalpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerTempsTotalpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerTempsTotalpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerTempsTotalpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerTempsTotalpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerTempsTotalpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerTempsTotalpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerTempsTotalpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerTempsRestantpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";    
import { calculerTempsRestantpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerTempsRestantpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerTempsRestantpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerTempsRestantpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerTempsRestantpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerTempsRestantpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerTempsRestantpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerTempsRestantpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerTempsdepuisHDVpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerTempsdepuisHDVpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerTempsdepuisHDVpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerTempsdepuisHDVpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerTempsdepuisHDVpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerTempsdepuisHDVpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerTempsdepuisHDVpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerTempsdepuisHDVpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerTempsdepuisHDVpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerTempsConstructionParHDVpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerTempsConstructionParHDVpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerTempsConstructionParHDVpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerTempsConstructionParHDVpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerTempsConstructionParHDVpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerTempsConstructionParHDVpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerTempsConstructionParHDVpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerTempsConstructionParHDVpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerTempsConstructionParHDVpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerPrixTotalpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerPrixTotalpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerPrixTotalpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerPrixTotalpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerPrixTotalpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerPrixTotalpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerPrixTotalpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerPrixTotalpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerPrixTotalpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerPrixRestantpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerPrixRestantpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerPrixRestantpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerPrixRestantpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerPrixRestantpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerPrixRestantpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerPrixRestantpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerPrixRestantpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerPrixRestantpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerPrixdepuisHDVpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerPrixdepuisHDVpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerPrixdepuisHDVpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerPrixdepuisHDVpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerPrixdepuisHDVpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerPrixdepuisHDVpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerPrixdepuisHDVpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerPrixdepuisHDVpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerPrixdepuisHDVpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerPrixConstructionParHDVpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerPrixConstructionParHDVpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerPrixConstructionParHDVpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerPrixConstructionParHDVpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerPrixConstructionParHDVpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerPrixConstructionParHDVpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerPrixConstructionParHDVpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerPrixConstructionParHDVpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerPrixConstructionParHDVpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerExperienceTotalpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerExperienceTotalpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerExperienceTotalpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerExperienceTotalpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerExperienceTotalpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerExperienceTotalpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerExperienceTotalpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerExperienceTotalpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerExperienceTotalpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerExperienceRestantpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerExperienceRestantpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerExperienceRestantpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerExperienceRestantpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerExperienceRestantpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerExperienceRestantpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerExperienceRestantpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerExperienceRestantpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerExperienceRestantpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerExperiencedepuisHDVpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerExperiencedepuisHDVpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerExperiencedepuisHDVpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerExperiencedepuisHDVpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerExperiencedepuisHDVpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerExperiencedepuisHDVpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerExperiencedepuisHDVpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerExperiencedepuisHDVpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerExperiencedepuisHDVpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { calculerExperienceConstructionParHDVpiege_ressort1 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort1.calc.js";
import { calculerExperienceConstructionParHDVpiege_ressort2 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort2.calc.js";
import { calculerExperienceConstructionParHDVpiege_ressort3 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort3.calc.js";
import { calculerExperienceConstructionParHDVpiege_ressort4 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort4.calc.js";
import { calculerExperienceConstructionParHDVpiege_ressort5 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort5.calc.js";
import { calculerExperienceConstructionParHDVpiege_ressort6 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort6.calc.js";
import { calculerExperienceConstructionParHDVpiege_ressort7 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort7.calc.js";
import { calculerExperienceConstructionParHDVpiege_ressort8 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort8.calc.js";
import { calculerExperienceConstructionParHDVpiege_ressort9 } from "/coc/code/village principal/batiments/calculator/piege calc/piege ressorts/piege ressort9.calc.js";

import { formatPrix } from "/coc/code/outils/affichge nombre.js";
import { convertirSecondescompact } from "/coc/code/outils/convertisseurtemps.js";

function getHDVLevel() {
    return document.getElementById("hdv").value;
}

function getpiege_ressortLevel(num) {
    return document.getElementById(`piege_ressort${num}`).value;
}

let hdvlevel = getHDVLevel(); // Récupérer le niveau de l'Hôtel de Ville

let piege_ressort1level = getpiege_ressortLevel(1);
let piege_ressort2level = getpiege_ressortLevel(2);
let piege_ressort3level = getpiege_ressortLevel(3);
let piege_ressort4level = getpiege_ressortLevel(4);
let piege_ressort5level = getpiege_ressortLevel(5);
let piege_ressort6level = getpiege_ressortLevel(6);
let piege_ressort7level = getpiege_ressortLevel(7);
let piege_ressort8level = getpiege_ressortLevel(8);
let piege_ressort9level = getpiege_ressortLevel(9);

let piege_ressort1levelmax = piege_ressort1_nv_max_hdv(hdvlevel);
let piege_ressort2levelmax = piege_ressort2_nv_max_hdv(hdvlevel);
let piege_ressort3levelmax = piege_ressort3_nv_max_hdv(hdvlevel);
let piege_ressort4levelmax = piege_ressort4_nv_max_hdv(hdvlevel);
let piege_ressort5levelmax = piege_ressort5_nv_max_hdv(hdvlevel);
let piege_ressort6levelmax = piege_ressort6_nv_max_hdv(hdvlevel);
let piege_ressort7levelmax = piege_ressort7_nv_max_hdv(hdvlevel);
let piege_ressort8levelmax = piege_ressort8_nv_max_hdv(hdvlevel);
let piege_ressort9levelmax = piege_ressort9_nv_max_hdv(hdvlevel);

export function calculerPourcentageNiveauxpiege_ressorts() {
    // Niveaux actuels
    const niveauxActuels = [
        Math.min(piege_ressort1level, piege_ressort1levelmax),
        Math.min(piege_ressort2level, piege_ressort2levelmax),
        Math.min(piege_ressort3level, piege_ressort3levelmax),
        Math.min(piege_ressort4level, piege_ressort4levelmax),
        Math.min(piege_ressort5level, piege_ressort5levelmax),
        Math.min(piege_ressort6level, piege_ressort6levelmax),
        Math.min(piege_ressort7level, piege_ressort7levelmax),
        Math.min(piege_ressort8level, piege_ressort8levelmax),
        Math.min(piege_ressort9level, piege_ressort9levelmax)
    ];

    // Niveaux max possibles selon HDV
    const niveauxMax = [
        piege_ressort1levelmax,
        piege_ressort2levelmax,
        piege_ressort3levelmax,
        piege_ressort4levelmax,
        piege_ressort5levelmax,
        piege_ressort6levelmax,
        piege_ressort7levelmax,
        piege_ressort8levelmax,
        piege_ressort9levelmax
    ];

    // Calcul des totaux
    const totalMax = niveauxMax.reduce((a, b) => a + b, 0);
    const totalActuel = niveauxActuels.reduce((a, b) => a + b, 0);

    if (totalMax === 0) return 0; // Évite la division par zéro

    const progression = (totalActuel / totalMax) * 100;
    return parseFloat(progression.toFixed(2)); // Limite a 2 décimales
}

export function globalcalculertempsRestantpiege_ressorts() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const piege_ressort1level = parseInt(getpiege_ressortLevel(1), 10);
    const piege_ressort2level = parseInt(getpiege_ressortLevel(2), 10);
    const piege_ressort3level = parseInt(getpiege_ressortLevel(3), 10);
    const piege_ressort4level = parseInt(getpiege_ressortLevel(4), 10);
    const piege_ressort5level = parseInt(getpiege_ressortLevel(5), 10);
    const piege_ressort6level = parseInt(getpiege_ressortLevel(6), 10);
    const piege_ressort7level = parseInt(getpiege_ressortLevel(7), 10);
    const piege_ressort8level = parseInt(getpiege_ressortLevel(8), 10);
    const piege_ressort9level = parseInt(getpiege_ressortLevel(9), 10);

    const piege_ressort1levelmax = piege_ressort1_nv_max_hdv(hdvlevel);
    const piege_ressort2levelmax = piege_ressort2_nv_max_hdv(hdvlevel);
    const piege_ressort3levelmax = piege_ressort3_nv_max_hdv(hdvlevel);
    const piege_ressort4levelmax = piege_ressort4_nv_max_hdv(hdvlevel);
    const piege_ressort5levelmax = piege_ressort5_nv_max_hdv(hdvlevel);
    const piege_ressort6levelmax = piege_ressort6_nv_max_hdv(hdvlevel);
    const piege_ressort7levelmax = piege_ressort7_nv_max_hdv(hdvlevel);
    const piege_ressort8levelmax = piege_ressort8_nv_max_hdv(hdvlevel);
    const piege_ressort9levelmax = piege_ressort9_nv_max_hdv(hdvlevel);

    let tempsRestant = 0;
    tempsRestant += calculerTempsRestantpiege_ressort1(piege_ressort1level, piege_ressort1levelmax);
    tempsRestant += calculerTempsRestantpiege_ressort2(piege_ressort2level, piege_ressort2levelmax);
    tempsRestant += calculerTempsRestantpiege_ressort3(piege_ressort3level, piege_ressort3levelmax);
    tempsRestant += calculerTempsRestantpiege_ressort4(piege_ressort4level, piege_ressort4levelmax);
    tempsRestant += calculerTempsRestantpiege_ressort5(piege_ressort5level, piege_ressort5levelmax);
    tempsRestant += calculerTempsRestantpiege_ressort6(piege_ressort6level, piege_ressort6levelmax);
    tempsRestant += calculerTempsRestantpiege_ressort7(piege_ressort7level, piege_ressort7levelmax);
    tempsRestant += calculerTempsRestantpiege_ressort8(piege_ressort8level, piege_ressort8levelmax);
    tempsRestant += calculerTempsRestantpiege_ressort9(piege_ressort9level, piege_ressort9levelmax);

    return tempsRestant;
}

export function globalcalculertempsTotalpiege_ressorts() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsTotalpiege_ressort1(piege_ressort1level);
    tempsTotal += calculerTempsTotalpiege_ressort2(piege_ressort2level);
    tempsTotal += calculerTempsTotalpiege_ressort3(piege_ressort3level);
    tempsTotal += calculerTempsTotalpiege_ressort4(piege_ressort4level);
    tempsTotal += calculerTempsTotalpiege_ressort5(piege_ressort5level);
    tempsTotal += calculerTempsTotalpiege_ressort6(piege_ressort6level);
    tempsTotal += calculerTempsTotalpiege_ressort7(piege_ressort7level);
    tempsTotal += calculerTempsTotalpiege_ressort8(piege_ressort8level);
    tempsTotal += calculerTempsTotalpiege_ressort9(piege_ressort9level);
    return tempsTotal;
}

export function globalcalculertempsdepuisHDVpiege_ressorts() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsdepuisHDVpiege_ressort1(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVpiege_ressort2(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVpiege_ressort3(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVpiege_ressort4(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVpiege_ressort5(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVpiege_ressort6(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVpiege_ressort7(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVpiege_ressort8(hdvlevel);
    tempsTotal += calculerTempsdepuisHDVpiege_ressort9(hdvlevel);
    return tempsTotal;
}

export function globalcalculertempsConstructionParHDVpiege_ressorts() {
    let tempsTotal = 0;
    tempsTotal += calculerTempsConstructionParHDVpiege_ressort1(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVpiege_ressort2(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVpiege_ressort3(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVpiege_ressort4(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVpiege_ressort5(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVpiege_ressort6(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVpiege_ressort7(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVpiege_ressort8(hdvlevel);
    tempsTotal += calculerTempsConstructionParHDVpiege_ressort9(hdvlevel);
    return tempsTotal;
}

export function barredeprogressiontempspiege_ressorts() {
    const tempsTotal = globalcalculertempsTotalpiege_ressorts();
    const tempsRestant = globalcalculertempsRestantpiege_ressorts();
    const tempsConstructionHDV = globalcalculertempsConstructionParHDVpiege_ressorts();

    if (tempsTotal === 0) {
        return 0; // Évite la division par zéro
    }

    if (tempsTotal >= tempsConstructionHDV) {
        const progression = ((tempsTotal - tempsRestant) / tempsTotal) * 100;
        return progression.toFixed(2);
    } else {
        // Ajout d'une tolérance pour éviter des valeurs négatives excessives
        const difference = tempsConstructionHDV - tempsTotal;
        if (difference < 0.01 * tempsConstructionHDV) { // Tolérance de 1%
            return 0; // Considérer comme aucune progression négative
        }
        const retard = (difference / tempsConstructionHDV) * 100;
        return (-retard).toFixed(2);
    }
}

export function globalcalculerPrixTotalpiege_ressort() {
    let couttotal = 0;
    couttotal += calculerPrixTotalpiege_ressort1(piege_ressort1level);
    couttotal += calculerPrixTotalpiege_ressort2(piege_ressort2level);
    couttotal += calculerPrixTotalpiege_ressort3(piege_ressort3level);
    couttotal += calculerPrixTotalpiege_ressort4(piege_ressort4level);
    couttotal += calculerPrixTotalpiege_ressort5(piege_ressort5level);
    couttotal += calculerPrixTotalpiege_ressort6(piege_ressort6level);
    couttotal += calculerPrixTotalpiege_ressort7(piege_ressort7level);
    couttotal += calculerPrixTotalpiege_ressort8(piege_ressort8level);
    couttotal += calculerPrixTotalpiege_ressort9(piege_ressort9level);
    return couttotal;
}

export function globalcalculerPrixRestantpiege_ressort() {
    const hdvlevel = parseInt(getHDVLevel(), 10);

    const piege_ressort1level = parseInt(getpiege_ressortLevel(1), 10);
    const piege_ressort2level = parseInt(getpiege_ressortLevel(2), 10);
    const piege_ressort3level = parseInt(getpiege_ressortLevel(3), 10);
    const piege_ressort4level = parseInt(getpiege_ressortLevel(4), 10);
    const piege_ressort5level = parseInt(getpiege_ressortLevel(5), 10);
    const piege_ressort6level = parseInt(getpiege_ressortLevel(6), 10);
    const piege_ressort7level = parseInt(getpiege_ressortLevel(7), 10);
    const piege_ressort8level = parseInt(getpiege_ressortLevel(8), 10);
    const piege_ressort9level = parseInt(getpiege_ressortLevel(9), 10);

    const piege_ressort1levelmax = piege_ressort1_nv_max_hdv(hdvlevel);
    const piege_ressort2levelmax = piege_ressort2_nv_max_hdv(hdvlevel);
    const piege_ressort3levelmax = piege_ressort3_nv_max_hdv(hdvlevel);
    const piege_ressort4levelmax = piege_ressort4_nv_max_hdv(hdvlevel);
    const piege_ressort5levelmax = piege_ressort5_nv_max_hdv(hdvlevel);
    const piege_ressort6levelmax = piege_ressort6_nv_max_hdv(hdvlevel);
    const piege_ressort7levelmax = piege_ressort7_nv_max_hdv(hdvlevel);
    const piege_ressort8levelmax = piege_ressort8_nv_max_hdv(hdvlevel);
    const piege_ressort9levelmax = piege_ressort9_nv_max_hdv(hdvlevel);

    let coutrestant = 0;
    coutrestant += calculerPrixRestantpiege_ressort1(piege_ressort1level, piege_ressort1levelmax);
    coutrestant += calculerPrixRestantpiege_ressort2(piege_ressort2level, piege_ressort2levelmax);
    coutrestant += calculerPrixRestantpiege_ressort3(piege_ressort3level, piege_ressort3levelmax);
    coutrestant += calculerPrixRestantpiege_ressort4(piege_ressort4level, piege_ressort4levelmax);
    coutrestant += calculerPrixRestantpiege_ressort5(piege_ressort5level, piege_ressort5levelmax);
    coutrestant += calculerPrixRestantpiege_ressort6(piege_ressort6level, piege_ressort6levelmax);
    coutrestant += calculerPrixRestantpiege_ressort7(piege_ressort7level, piege_ressort7levelmax);
    coutrestant += calculerPrixRestantpiege_ressort8(piege_ressort8level, piege_ressort8levelmax);
    coutrestant += calculerPrixRestantpiege_ressort9(piege_ressort9level, piege_ressort9levelmax);
    return coutrestant;
}

export function globalcalculerPrixdepuisHDVpiege_ressort() {
    let couttotal = 0;
    couttotal += calculerPrixdepuisHDVpiege_ressort1(hdvlevel);
    couttotal += calculerPrixdepuisHDVpiege_ressort2(hdvlevel);
    couttotal += calculerPrixdepuisHDVpiege_ressort3(hdvlevel);
    couttotal += calculerPrixdepuisHDVpiege_ressort4(hdvlevel);
    couttotal += calculerPrixdepuisHDVpiege_ressort5(hdvlevel);
    couttotal += calculerPrixdepuisHDVpiege_ressort6(hdvlevel);
    couttotal += calculerPrixdepuisHDVpiege_ressort7(hdvlevel);
    couttotal += calculerPrixdepuisHDVpiege_ressort8(hdvlevel);
    couttotal += calculerPrixdepuisHDVpiege_ressort9(hdvlevel);
    return couttotal;
}

export function globalcalculerPrixConstructionParHDVpiege_ressort() {
    let couttotal = 0;
    couttotal += calculerPrixConstructionParHDVpiege_ressort1(hdvlevel);
    couttotal += calculerPrixConstructionParHDVpiege_ressort2(hdvlevel);
    couttotal += calculerPrixConstructionParHDVpiege_ressort3(hdvlevel);
    couttotal += calculerPrixConstructionParHDVpiege_ressort4(hdvlevel);
    couttotal += calculerPrixConstructionParHDVpiege_ressort5(hdvlevel);
    couttotal += calculerPrixConstructionParHDVpiege_ressort6(hdvlevel);
    couttotal += calculerPrixConstructionParHDVpiege_ressort7(hdvlevel);
    couttotal += calculerPrixConstructionParHDVpiege_ressort8(hdvlevel);
    couttotal += calculerPrixConstructionParHDVpiege_ressort9(hdvlevel);
    return couttotal;
}

export function barredeprogrssionprixpiege_ressorts () {
    const prixTotal = globalcalculerprixTotalpiege_ressorts();
    const prixRestant = globalcalculerprixRestantpiege_ressorts();
    const prixConstructionHDV = globalcalculerprixConstructionParHDVpiege_ressorts();
    if (prixTotal > prixConstructionHDV) {
        let progression = ((prixTotal - prixRestant) / prixTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((prixConstructionHDV - prixTotal) / prixTotal) * 100;
        return (-retard).toFixed(2);
    }
}


export function globalcalculerExperienceTotalpiege_ressort() {
    let expTotal = 0;
    expTotal += calculerExperienceTotalpiege_ressort1(piege_ressort1level);
    expTotal += calculerExperienceTotalpiege_ressort2(piege_ressort2level);
    expTotal += calculerExperienceTotalpiege_ressort3(piege_ressort3level);
    expTotal += calculerExperienceTotalpiege_ressort4(piege_ressort4level);
    expTotal += calculerExperienceTotalpiege_ressort5(piege_ressort5level);
    expTotal += calculerExperienceTotalpiege_ressort6(piege_ressort6level);
    expTotal += calculerExperienceTotalpiege_ressort7(piege_ressort7level);
    expTotal += calculerExperienceTotalpiege_ressort8(piege_ressort8level);
    expTotal += calculerExperienceTotalpiege_ressort9(piege_ressort9level);
    return expTotal;
}

export function globalcalculerExperienceRestantpiege_ressort() {
    let exprestant = 0;
    exprestant += calculerExperienceRestantpiege_ressort1(piege_ressort1level, piege_ressort1levelmax);
    exprestant += calculerExperienceRestantpiege_ressort2(piege_ressort2level, piege_ressort2levelmax);
    exprestant += calculerExperienceRestantpiege_ressort3(piege_ressort3level, piege_ressort3levelmax);
    exprestant += calculerExperienceRestantpiege_ressort4(piege_ressort4level, piege_ressort4levelmax);
    exprestant += calculerExperienceRestantpiege_ressort5(piege_ressort5level, piege_ressort5levelmax);
    exprestant += calculerExperienceRestantpiege_ressort6(piege_ressort6level, piege_ressort6levelmax);
    exprestant += calculerExperienceRestantpiege_ressort7(piege_ressort7level, piege_ressort7levelmax);
    exprestant += calculerExperienceRestantpiege_ressort8(piege_ressort8level, piege_ressort8levelmax);
    exprestant += calculerExperienceRestantpiege_ressort9(piege_ressort9level, piege_ressort9levelmax);
    return exprestant;
}

export function globalcalculerExperiencedepuisHDVpiege_ressort() {
    let exptotal = 0;
    exptotal += calculerExperiencedepuisHDVpiege_ressort1(hdvlevel);
    exptotal += calculerExperiencedepuisHDVpiege_ressort2(hdvlevel);
    exptotal += calculerExperiencedepuisHDVpiege_ressort3(hdvlevel);
    exptotal += calculerExperiencedepuisHDVpiege_ressort4(hdvlevel);
    exptotal += calculerExperiencedepuisHDVpiege_ressort5(hdvlevel);
    exptotal += calculerExperiencedepuisHDVpiege_ressort6(hdvlevel);
    exptotal += calculerExperiencedepuisHDVpiege_ressort7(hdvlevel);
    exptotal += calculerExperiencedepuisHDVpiege_ressort8(hdvlevel);
    exptotal += calculerExperiencedepuisHDVpiege_ressort9(hdvlevel);
    return exptotal;
}

export function globalcalculerExperienceConstructionParHDVpiege_ressort() {
    let exptotal = 0;
    exptotal += calculerExperienceConstructionParHDVpiege_ressort1(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVpiege_ressort2(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVpiege_ressort3(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVpiege_ressort4(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVpiege_ressort5(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVpiege_ressort6(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVpiege_ressort7(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVpiege_ressort8(hdvlevel);
    exptotal += calculerExperienceConstructionParHDVpiege_ressort9(hdvlevel);
    return exptotal;
}

export function barredeprogressionexppiege_ressorts() {
    const expTotal = globalcalculerExperienceTotalpiege_ressort();
    const expRestant = globalcalculerExperienceRestantpiege_ressort();
    const expConstructionHDV = globalcalculerExperienceConstructionParHDVpiege_ressort();
    if (expTotal > expConstructionHDV) {
        let progression = ((expTotal - expRestant) / expTotal) * 100;
        return progression.toFixed(2);
    } else {
        let retard = ((expConstructionHDV - expTotal) / expTotal) * 100;
        return (-retard).toFixed(2);
    }
}

// Fonction pour mettre à jour la barre de progression
function updatepiege_ressortProgress() {
    // Recalculer le niveau de l'Hôtel de Ville
    hdvlevel = getHDVLevel();

    // Recalculer les niveaux des piege_ressorts
    piege_ressort1level = getpiege_ressortLevel(1);
    piege_ressort2level = getpiege_ressortLevel(2);
    piege_ressort3level = getpiege_ressortLevel(3);
    piege_ressort4level = getpiege_ressortLevel(4);
    piege_ressort5level = getpiege_ressortLevel(5);
    piege_ressort6level = getpiege_ressortLevel(6);
    piege_ressort7level = getpiege_ressortLevel(7);
    piege_ressort8level = getpiege_ressortLevel(8);
    piege_ressort9level = getpiege_ressortLevel(9);

    // Recalculer les niveaux maximums des piege_ressorts en fonction du niveau HDV
    piege_ressort1levelmax = piege_ressort1_nv_max_hdv(hdvlevel);
    piege_ressort2levelmax = piege_ressort2_nv_max_hdv(hdvlevel);
    piege_ressort3levelmax = piege_ressort3_nv_max_hdv(hdvlevel);
    piege_ressort4levelmax = piege_ressort4_nv_max_hdv(hdvlevel);
    piege_ressort5levelmax = piege_ressort5_nv_max_hdv(hdvlevel);
    piege_ressort6levelmax = piege_ressort6_nv_max_hdv(hdvlevel);
    piege_ressort7levelmax = piege_ressort7_nv_max_hdv(hdvlevel);
    piege_ressort8levelmax = piege_ressort8_nv_max_hdv(hdvlevel);
    piege_ressort9levelmax = piege_ressort9_nv_max_hdv(hdvlevel);
    // Calculer le pourcentage de progression
    const progression = calculerPourcentageNiveauxpiege_ressorts();

    // Mettre à jour la barre de progression et le texte
    const progressBar = document.getElementById('progress-piege_ressorts');
    const progressText = document.getElementById('progress-piege_ressorts-value');
    const progressTimeText = document.getElementById('progress-piege_ressorts-temps');
    const progressPriceText = document.getElementById('progress-piege_ressorts-prix-or');

    if (progressBar && progressText) {
        progressBar.value = progression;
        progressText.textContent = `${progression.toFixed(2)}%`; // Limiter à 2 décimales
    }
    if (progressTimeText) {
        const tempsRestant = globalcalculertempsRestantpiege_ressorts();
        if (tempsRestant === 0) {
            progressTimeText.style.display = "none";
        }
        else {
            progressTimeText.style.display = "";
            progressTimeText.innerHTML = `${convertirSecondescompact(tempsRestant)} <img src="/coc/image/général/ressource/temps icone.png" alt="temps" class="icone-ressource">`;
        }
    }
    if (progressPriceText) {
        const prixRestant = globalcalculerPrixRestantpiege_ressort();
        if (prixRestant === 0){
            progressPriceText.style.display = "none";
        }
        else {
            progressPriceText.style.display = "";
            progressPriceText.innerHTML = `${formatPrix(prixRestant)} <img src="/coc/image/village principal/ressource/or village-p.jpg" alt="or" class="icone-ressource">`;
        }
    }
}

// Ajouter des écouteurs d'événements pour détecter les changements
document.addEventListener('DOMContentLoaded', () => {
    const piege_ressortSelects = [
        document.getElementById('piege_ressort1'),
        document.getElementById('piege_ressort2'),
        document.getElementById('piege_ressort3'),
        document.getElementById('piege_ressort4'),
        document.getElementById('piege_ressort5'),
        document.getElementById('piege_ressort6'),
        document.getElementById('piege_ressort7'),
        document.getElementById('piege_ressort8'),
        document.getElementById('piege_ressort9')
    ];

    // Ajouter un écouteur pour chaque piege_ressort
    piege_ressortSelects.forEach(select => {
        if (select) {
            select.addEventListener('change', updatepiege_ressortProgress);
        }
    });

    // Ajouter un écouteur pour le changement du niveau HDV
    const hdvSelect = document.getElementById('hdv');
    if (hdvSelect) {
        hdvSelect.addEventListener('change', updatepiege_ressortProgress);
    }

    // Initialiser la barre de progression au chargement
    updatepiege_ressortProgress();
});